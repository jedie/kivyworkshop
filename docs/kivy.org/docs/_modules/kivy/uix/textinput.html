<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from kivy.org/docs/_modules/kivy/uix/textinput.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jan 2015 07:56:38 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="twitter:site" content="@kivyframework">
    
    <title>kivy.uix.textinput &mdash; Kivy 1.9.0-dev documentation</title>
    <link href='../../../../../fonts.googleapis.com/css8da2.css?family=Source+Code+Pro:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../../../_static/fresh.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.9.0-dev',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../cdn.mathjax.org/mathjax/latest/MathJaxdda6.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/jquery-effects-core-and-slide.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../../_static/kivy.js"></script>
    <link rel="top" title="Kivy 1.9.0-dev documentation" href="../../../index-2.html" />
    <link rel="up" title="kivy" href="../../kivy.html" /> 
  </head>
  <body>

    <div id="topbar">
        <div id="topwrapper">
        <div id="toplogo">
            <a href="http://kivy.org/">
                <img src="../../../_static/logo-kivy.png" alt="Kivy" height="50"/>
            </a>
        </div>
        <div id="topmenu">
            <ul class="navigation">
                <li><a class="nav-guides" href="../../../gettingstarted/intro.html">Guides</a></li>
                <li><a class="nav-garden" href="http://kivy-garden.github.io/">Garden</a></li>
                <li><a class="nav-api" href="../../../api-kivy.html">API Reference</a></li>
                <li><a class="nav-pdf" href="../../../pdf/Kivy-latest.pdf">PDF</a></li>
                <li><a class="nav-wiki" href="http://wiki.kivy.org/">Wiki</a></li>
            </ul>
        </div>
        </div>
    </div>
<div id="contentall">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Quick search</h3>
            <form class="search" action="http://kivy.org/docs/search.html" method="get">
                &nbsp;
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
                <input type="text" class="text" name="q" />
            </form>
          <!--
          <h3><a href="../../../index.html">kivy.uix.textinput</a></h3>
          
          <h3><a href="../../../index.html">Table Of Contents</a></h3>
          -->
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/first_app.html">A first App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/properties.html">Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/rules.html">Kv Design Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/framework.html">Non-widget stuff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/layouts.html">Layouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/drawing.html">Drawing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/packaging.html">Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/diving.html">Diving in</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide.html">User&#8217;s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../philosophy.html">Philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contribute.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faq.html">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contact.html">Contact Us</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide-index.html">Programming Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/basic.html">Kivy Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/environment.html">Controlling the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/config.html">Configure Kivy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/architecture.html">Architectural Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/events.html">Events and Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/inputs.html">Input management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/widgets.html">Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/graphics.html">Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/lang.html">Kv language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/other-frameworks.html">Integrating with other Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/bestpractices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/advancedgraphics.html">Advanced Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/packaging.html">Packaging your application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials-index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/pong.html">Pong Game Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/firstwidget.html">A Simple Paint App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.html">Kivy framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.html">Adapters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.adapter.html">Adapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.args_converters.html">List Item View Argument Converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.dictadapter.html">DictAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.listadapter.html">ListAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.models.html">SelectableDataItem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.simplelistadapter.html">SimpleListAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.animation.html">Animation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.app.html">Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.atlas.html">Atlas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.base.html">Kivy Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.cache.html">Cache manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.clock.html">Clock object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.compat.html">Compatibility module for Python 2.7 and &gt; 3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.config.html">Configuration object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.context.html">Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.html">Core Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.audio.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.camera.html">Camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.clipboard.html">Clipboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.gl.html">OpenGL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.image.html">Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.spelling.html">Spelling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.text.html">Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.text.markup.html">Text Markup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.text.text_layout.html">Text layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.video.html">Video</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.window.html">Window</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.html">Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.dampedscroll.html">Damped scroll effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.kinetic.html">Kinetic effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.opacityscroll.html">Opacity scroll effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.scroll.html">Scroll effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.event.html">Event dispatcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.ext.html">Extension Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.factory.html">Factory object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.garden.html">Garden</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.geometry.html">Geometry utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.gesture.html">Gesture recognition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.html">Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.compiler.html">Graphics compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.context.html">Context management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.context_instructions.html">Context instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.fbo.html">Framebuffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.gl_instructions.html">GL instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.instructions.html">Canvas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.opengl.html">OpenGL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.opengl_utils.html">OpenGL utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.shader.html">Shader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.stencil_instructions.html">Stencil instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.svg.html">SVG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.tesselator.html">Tesselator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.texture.html">Texture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.transformation.html">Transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.html">Input management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.factory.html">Motion Event Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.motionevent.html">Motion Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.html">Input Postprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.calibration.html">Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.dejitter.html">Dejitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.doubletap.html">Double Tap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.ignorelist.html">Ignore list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.retaintouch.html">Retain Touch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.tripletap.html">Triple Tap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.provider.html">Motion Event Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.html">Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.androidjoystick.html">Android Joystick Input Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.hidinput.html">Native support for HID input from the linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.leapfinger.html">Leap Motion - finger only</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.linuxwacom.html">Native support of Wacom tablet from linuxwacom driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.mactouch.html">Native support of MultitouchSupport framework for MacBook (MaxOSX platform)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.mouse.html">Mouse provider implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.mtdev.html">Native support for Multitouch devices on Linux, using libmtdev.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.probesysfs.html">Auto Create Input Provider Config Entry for Available MT Hardware (linux only).</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.tuio.html">TUIO Input Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.wm_common.html">Common definitions for a Windows provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.wm_pen.html">Support for WM_PEN messages (Windows platform)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.wm_touch.html">Support for WM_TOUCH messages (Windows platform)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.recorder.html">Input recorder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.shape.html">Motion Event Shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.interactive.html">Interactive launcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.lang.html">Kivy Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.lib.html">External libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.lib.gstplayer.html">GstPlayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.loader.html">Asynchronous data loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.logger.html">Logger object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.inspector.html">Inspector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.keybinding.html">Keybinding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.monitor.html">Monitor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.recorder.html">Recorder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.screen.html">Screen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.touchring.html">Touchring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.webdebugger.html">Web Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.multistroke.html">Multistroke gesture recognizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.network.html">Network support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.network.urlrequest.html">Url Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.parser.html">Parser utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.properties.html">Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.resources.html">Resources management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.storage.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.storage.dictstore.html">Dictionary store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.storage.jsonstore.html">JSON store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.storage.redisstore.html">Redis Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.support.html">Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.html">Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.abstractview.html">Abstract View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.accordion.html">Accordion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.actionbar.html">Action Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.anchorlayout.html">Anchor Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.behaviors.html">Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.boxlayout.html">Box Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.bubble.html">Bubble</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.button.html">Button</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.camera.html">Camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.carousel.html">Carousel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.checkbox.html">CheckBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.codeinput.html">Code Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.colorpicker.html">Color Picker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.dropdown.html">Drop-Down List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.effectwidget.html">EffectWidget</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.filechooser.html">FileChooser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.floatlayout.html">Float Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.gesturesurface.html">Gesture Surface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.gridlayout.html">Grid Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.image.html">Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.label.html">Label</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.layout.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.listview.html">List View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.modalview.html">ModalView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.pagelayout.html">PageLayout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.popup.html">Popup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.progressbar.html">Progress Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.relativelayout.html">Relative Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.rst.html">reStructuredText renderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.sandbox.html">Sandbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.scatter.html">Scatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.scatterlayout.html">Scatter Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.screenmanager.html">Screen Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.scrollview.html">Scroll View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.settings.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.slider.html">Slider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.spinner.html">Spinner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.splitter.html">Splitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.stacklayout.html">Stack Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.stencilview.html">Stencil View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.switch.html">Switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.tabbedpanel.html">TabbedPanel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.textinput.html">Text Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.togglebutton.html">Toggle button</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.treeview.html">Tree View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.video.html">Video</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.videoplayer.html">Video player</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.vkeyboard.html">VKeyboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.widget.html">Widget class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.utils.html">Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.vector.html">Vector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.weakmethod.html">Weak Method</a></li>
</ul>
</li>
</ul>

          <!--
          <h3>Related Topics</h3>
          <ul>
          </ul>
          -->
        </div>
      </div>
    <div id="content">
    <div class="wrapper">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div class="toc"><h2>Table Of Contents</h2></div>
            
  <h1>Source code for kivy.uix.textinput</h1><div class="highlight"><pre>
<span class="c"># -*- encoding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Text Input</span>
<span class="sd">==========</span>

<span class="sd">.. versionadded:: 1.0.4</span>

<span class="sd">.. image:: images/textinput-mono.jpg</span>
<span class="sd">.. image:: images/textinput-multi.jpg</span>

<span class="sd">The :class:`TextInput` widget provides a box of editable plain text.</span>

<span class="sd">Unicode, multiline, cursor navigation, selection and clipboard features</span>
<span class="sd">are supported.</span>

<span class="sd">.. note::</span>

<span class="sd">    Two different coordinate systems are used with TextInput:</span>

<span class="sd">        - (x, y) - coordinates in pixels, mostly used for rendering on screen.</span>
<span class="sd">        - (row, col) - cursor index in characters / lines, used for selection</span>
<span class="sd">          and cursor movement.</span>


<span class="sd">Usage example</span>
<span class="sd">-------------</span>

<span class="sd">To create a multiline textinput (&#39;enter&#39; key adds a new line)::</span>

<span class="sd">    from kivy.uix.textinput import TextInput</span>
<span class="sd">    textinput = TextInput(text=&#39;Hello world&#39;)</span>

<span class="sd">To create a singleline textinput, set the multiline property to False (&#39;enter&#39;</span>
<span class="sd">key will defocus the textinput and emit on_text_validate event)::</span>

<span class="sd">    def on_enter(instance, value):</span>
<span class="sd">        print(&#39;User pressed enter in&#39;, instance)</span>

<span class="sd">    textinput = TextInput(text=&#39;Hello world&#39;, multiline=False)</span>
<span class="sd">    textinput.bind(on_text_validate=on_enter)</span>

<span class="sd">The textinput&#39;s text is stored on its :attr:`TextInput.text` property. To run a</span>
<span class="sd">callback when the text changes::</span>

<span class="sd">    def on_text(instance, value):</span>
<span class="sd">        print(&#39;The widget&#39;, instance, &#39;have:&#39;, value)</span>

<span class="sd">    textinput = TextInput()</span>
<span class="sd">    textinput.bind(text=on_text)</span>

<span class="sd">You can &#39;focus&#39; a textinput, meaning that the input box will be highlighted</span>
<span class="sd">and keyboard focus will be requested::</span>

<span class="sd">    textinput = TextInput(focus=True)</span>

<span class="sd">The textinput is defocused if the &#39;escape&#39; key is pressed, or if another</span>
<span class="sd">widget requests the keyboard. You can bind a callback to the focus property to</span>
<span class="sd">get notified of focus changes::</span>

<span class="sd">    def on_focus(instance, value):</span>
<span class="sd">        if value:</span>
<span class="sd">            print(&#39;User focused&#39;, instance)</span>
<span class="sd">        else:</span>
<span class="sd">            print(&#39;User defocused&#39;, instance)</span>

<span class="sd">    textinput = TextInput()</span>
<span class="sd">    textinput.bind(focus=on_focus)</span>


<span class="sd">Selection</span>
<span class="sd">---------</span>

<span class="sd">The selection is automatically updated when the cursor position changes.</span>
<span class="sd">You can get the currently selected text from the</span>
<span class="sd">:attr:`TextInput.selection_text` property.</span>

<span class="sd">Filtering</span>
<span class="sd">---------</span>

<span class="sd">You can control which text can be added to the :class:`TextInput` by</span>
<span class="sd">overwriting :meth:`TextInput.insert_text`.Every string that is typed, pasted</span>
<span class="sd">or inserted by any other means to the :class:`TextInput` is passed through</span>
<span class="sd">this function. By overwriting it you can reject or change unwanted characters.</span>

<span class="sd">For example, to write only in capitalized characters::</span>

<span class="sd">    class CapitalInput(TextInput):</span>

<span class="sd">        def insert_text(self, substring, from_undo=False):</span>
<span class="sd">            s = substring.upper()</span>
<span class="sd">            return super(CapitalInput, self).insert_text(s,\</span>
<span class="sd"> from_undo=from_undo)</span>

<span class="sd">Or to only allow floats (0 - 9 and a single period)::</span>

<span class="sd">    class FloatInput(TextInput):</span>

<span class="sd">        pat = re.compile(&#39;[^0-9]&#39;)</span>
<span class="sd">        def insert_text(self, substring, from_undo=False):</span>
<span class="sd">            pat = self.pat</span>
<span class="sd">            if &#39;.&#39; in self.text:</span>
<span class="sd">                s = re.sub(pat, &#39;&#39;, substring)</span>
<span class="sd">            else:</span>
<span class="sd">                s = &#39;.&#39;.join([re.sub(pat, &#39;&#39;, s) for s in\</span>
<span class="sd"> substring.split(&#39;.&#39;, 1)])</span>
<span class="sd">            return super(FloatInput, self).insert_text(s, from_undo=from_undo)</span>

<span class="sd">Default shortcuts</span>
<span class="sd">-----------------</span>

<span class="sd">=============== ========================================================</span>
<span class="sd">   Shortcuts    Description</span>
<span class="sd">--------------- --------------------------------------------------------</span>
<span class="sd">Left            Move cursor to left</span>
<span class="sd">Right           Move cursor to right</span>
<span class="sd">Up              Move cursor to up</span>
<span class="sd">Down            Move cursor to down</span>
<span class="sd">Home            Move cursor at the beginning of the line</span>
<span class="sd">End             Move cursor at the end of the line</span>
<span class="sd">PageUp          Move cursor to 3 lines before</span>
<span class="sd">PageDown        Move cursor to 3 lines after</span>
<span class="sd">Backspace       Delete the selection or character before the cursor</span>
<span class="sd">Del             Delete the selection of character after the cursor</span>
<span class="sd">Shift + &lt;dir&gt;   Start a text selection. Dir can be Up, Down, Left, Right</span>
<span class="sd">Control + c     Copy selection</span>
<span class="sd">Control + x     Cut selection</span>
<span class="sd">Control + p     Paste selection</span>
<span class="sd">Control + a     Select all the content</span>
<span class="sd">Control + z     undo</span>
<span class="sd">Control + r     redo</span>
<span class="sd">=============== ========================================================</span>

<span class="sd">&#39;&#39;&#39;</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;TextInput&#39;</span><span class="p">,</span> <span class="p">)</span>


<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">environ</span>
<span class="kn">from</span> <span class="nn">weakref</span> <span class="kn">import</span> <span class="n">ref</span>

<span class="kn">from</span> <span class="nn">kivy.animation</span> <span class="kn">import</span> <span class="n">Animation</span>
<span class="kn">from</span> <span class="nn">kivy.base</span> <span class="kn">import</span> <span class="n">EventLoop</span>
<span class="kn">from</span> <span class="nn">kivy.cache</span> <span class="kn">import</span> <span class="n">Cache</span>
<span class="kn">from</span> <span class="nn">kivy.clock</span> <span class="kn">import</span> <span class="n">Clock</span>
<span class="kn">from</span> <span class="nn">kivy.config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">kivy.compat</span> <span class="kn">import</span> <span class="n">PY2</span>
<span class="kn">from</span> <span class="nn">kivy.logger</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">kivy.metrics</span> <span class="kn">import</span> <span class="n">inch</span>
<span class="kn">from</span> <span class="nn">kivy.utils</span> <span class="kn">import</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">platform</span>
<span class="kn">from</span> <span class="nn">kivy.uix.behaviors</span> <span class="kn">import</span> <span class="n">FocusBehavior</span>

<span class="kn">from</span> <span class="nn">kivy.core.text</span> <span class="kn">import</span> <span class="n">Label</span>
<span class="kn">from</span> <span class="nn">kivy.graphics</span> <span class="kn">import</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Rectangle</span>
<span class="kn">from</span> <span class="nn">kivy.graphics.texture</span> <span class="kn">import</span> <span class="n">Texture</span>

<span class="kn">from</span> <span class="nn">kivy.uix.widget</span> <span class="kn">import</span> <span class="n">Widget</span>
<span class="kn">from</span> <span class="nn">kivy.uix.bubble</span> <span class="kn">import</span> <span class="n">Bubble</span>
<span class="kn">from</span> <span class="nn">kivy.uix.behaviors</span> <span class="kn">import</span> <span class="n">ButtonBehavior</span>
<span class="kn">from</span> <span class="nn">kivy.uix.image</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">from</span> <span class="nn">kivy.properties</span> <span class="kn">import</span> <span class="n">StringProperty</span><span class="p">,</span> <span class="n">NumericProperty</span><span class="p">,</span> \
    <span class="n">BooleanProperty</span><span class="p">,</span> <span class="n">AliasProperty</span><span class="p">,</span> \
    <span class="n">ListProperty</span><span class="p">,</span> <span class="n">ObjectProperty</span><span class="p">,</span> <span class="n">VariableListProperty</span><span class="p">,</span> <span class="n">OptionProperty</span>

<span class="n">Cache_register</span> <span class="o">=</span> <span class="n">Cache</span><span class="o">.</span><span class="n">register</span>
<span class="n">Cache_append</span> <span class="o">=</span> <span class="n">Cache</span><span class="o">.</span><span class="n">append</span>
<span class="n">Cache_get</span> <span class="o">=</span> <span class="n">Cache</span><span class="o">.</span><span class="n">get</span>
<span class="n">Cache_remove</span> <span class="o">=</span> <span class="n">Cache</span><span class="o">.</span><span class="n">remove</span>
<span class="n">Cache_register</span><span class="p">(</span><span class="s">&#39;textinput.label&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.</span><span class="p">)</span>
<span class="n">Cache_register</span><span class="p">(</span><span class="s">&#39;textinput.width&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">60.</span><span class="p">)</span>

<span class="n">FL_IS_NEWLINE</span> <span class="o">=</span> <span class="mh">0x01</span>

<span class="c"># late binding</span>
<span class="n">Clipboard</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">_platform</span> <span class="o">=</span> <span class="n">platform</span>

<span class="c"># for reloading, we need to keep a list of textinput to retrigger the rendering</span>
<span class="n">_textinput_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># cache the result</span>
<span class="n">_is_osx</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span>

<span class="c"># When we are generating documentation, Config doesn&#39;t exist</span>
<span class="n">_is_desktop</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">if</span> <span class="n">Config</span><span class="p">:</span>
    <span class="n">_is_desktop</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s">&#39;kivy&#39;</span><span class="p">,</span> <span class="s">&#39;desktop&#39;</span><span class="p">)</span>

<span class="c"># register an observer to clear the textinput cache when OpenGL will reload</span>
<span class="k">if</span> <span class="s">&#39;KIVY_DOC&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">environ</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">_textinput_clear_cache</span><span class="p">(</span><span class="o">*</span><span class="n">l</span><span class="p">):</span>
        <span class="n">Cache_remove</span><span class="p">(</span><span class="s">&#39;textinput.label&#39;</span><span class="p">)</span>
        <span class="n">Cache_remove</span><span class="p">(</span><span class="s">&#39;textinput.width&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="n">_textinput_list</span><span class="p">[:]:</span>
            <span class="n">textinput</span> <span class="o">=</span> <span class="n">wr</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">textinput</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">_textinput_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">textinput</span><span class="o">.</span><span class="n">_trigger_refresh_text</span><span class="p">()</span>
                <span class="n">textinput</span><span class="o">.</span><span class="n">_refresh_hint_text</span><span class="p">()</span>

    <span class="kn">from</span> <span class="nn">kivy.graphics.context</span> <span class="kn">import</span> <span class="n">get_context</span>
    <span class="n">get_context</span><span class="p">()</span><span class="o">.</span><span class="n">add_reload_observer</span><span class="p">(</span><span class="n">_textinput_clear_cache</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Selector</span><span class="p">(</span><span class="n">ButtonBehavior</span><span class="p">,</span> <span class="n">Image</span><span class="p">):</span>
    <span class="c"># Internal class for managing the selection Handles.</span>

    <span class="n">window</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Selector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_touch_down</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">on_window_touch_down</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_window_touch_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">touch</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
            <span class="n">touch</span><span class="o">.</span><span class="n">apply_transform_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_widget</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_touch_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">-</span> <span class="n">touch</span><span class="o">.</span><span class="n">y</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span><span class="o">*</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">):</span>
                <span class="n">FocusBehavior</span><span class="o">.</span><span class="n">ignored_touch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">touch</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Selector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">on_touch_down</span><span class="p">(</span><span class="n">touch</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">touch</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">TextInputCutCopyPaste</span><span class="p">(</span><span class="n">Bubble</span><span class="p">):</span>
    <span class="c"># Internal class used for showing the little bubble popup when</span>
    <span class="c"># copy/cut/paste happen.</span>

    <span class="n">textinput</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39; Holds a reference to the TextInput this Bubble belongs to.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">but_cut</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">but_copy</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">but_paste</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">but_selectall</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;normal&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TextInputCutCopyPaste</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_parent</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_touch_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span><span class="o">*</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">):</span>
            <span class="n">FocusBehavior</span><span class="o">.</span><span class="n">ignored_touch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">touch</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TextInputCutCopyPaste</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">on_touch_down</span><span class="p">(</span><span class="n">touch</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_textinput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">Clipboard</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Clipboard</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_is_desktop</span><span class="p">:</span>
            <span class="n">value</span><span class="o">.</span><span class="n">_ensure_clipboard</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="c"># this is a prevention to get the Bubble staying on the screen, if the</span>
        <span class="c"># attached textinput is not on the screen anymore.</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textinput</span>
        <span class="k">while</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="o">==</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_parent</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">textinput</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">textinput</span><span class="o">.</span><span class="n">_hide_cut_copy_paste</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textinput</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span>

        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;paste&#39;</span><span class="p">:</span>
                <span class="c"># show only paste on long touch</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">but_selectall</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">widget_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">but_selectall</span><span class="p">,</span> <span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
                    <span class="n">widget_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">but_paste</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">parent</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
                <span class="c"># show only copy for read only text input</span>
                <span class="n">widget_list</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">but_copy</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># normal mode</span>
                <span class="n">widget_list</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">but_cut</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_copy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">but_paste</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widget_list</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">textinput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textinput</span>

        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cut&#39;</span><span class="p">:</span>
            <span class="n">textinput</span><span class="o">.</span><span class="n">_cut</span><span class="p">(</span><span class="n">textinput</span><span class="o">.</span><span class="n">selection_text</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;copy&#39;</span><span class="p">:</span>
            <span class="n">textinput</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;paste&#39;</span><span class="p">:</span>
            <span class="n">textinput</span><span class="o">.</span><span class="n">paste</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;selectall&#39;</span><span class="p">:</span>
            <span class="n">textinput</span><span class="o">.</span><span class="n">select_all</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">anim</span> <span class="o">=</span> <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">333</span><span class="p">)</span>
            <span class="n">anim</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_complete</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">on_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
            <span class="n">anim</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">but_selectall</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">anim</span> <span class="o">=</span> <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">225</span><span class="p">)</span>
        <span class="n">anim</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_complete</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">parent</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">anim</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="TextInput"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput">[docs]</a><span class="k">class</span> <span class="nc">TextInput</span><span class="p">(</span><span class="n">FocusBehavior</span><span class="p">,</span> <span class="n">Widget</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;TextInput class. See module documentation for more information.</span>

<span class="sd">    :Events:</span>
<span class="sd">        `on_text_validate`</span>
<span class="sd">            Fired only in multiline=False mode when the user hits &#39;enter&#39;.</span>
<span class="sd">            This will also unfocus the textinput.</span>
<span class="sd">        `on_double_tap`</span>
<span class="sd">            Fired when a double tap happens in the text input. The default</span>
<span class="sd">            behavior selects the text around the cursor position. More info at</span>
<span class="sd">            :meth:`on_double_tap`.</span>
<span class="sd">        `on_triple_tap`</span>
<span class="sd">            Fired when a triple tap happens in the text input. The default</span>
<span class="sd">            behavior selects the line around the cursor position. More info at</span>
<span class="sd">            :meth:`on_triple_tap`.</span>
<span class="sd">        `on_quad_touch`</span>
<span class="sd">            Fired when four fingers are touching the text input. The default</span>
<span class="sd">            behavior selects the whole text. More info at</span>
<span class="sd">            :meth:`on_quad_touch`.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        When changing a :class:`TextInput` property that requires re-drawing,</span>
<span class="sd">        e.g. modifying the :attr:`text`, the updates occur on the next</span>
<span class="sd">        clock cycle and not instantly. This might cause any changes to the</span>
<span class="sd">        :class:`TextInput` that occur between the modification and the next</span>
<span class="sd">        cycle to be ignored, or to use previous values. For example, after</span>
<span class="sd">        a update to the :attr:`text`, changing the cursor in the same clock</span>
<span class="sd">        frame will move it using the previous text and will likely end up in an</span>
<span class="sd">        incorrect position. The solution is to schedule any updates to occur</span>
<span class="sd">        on the next clock cycle using</span>
<span class="sd">        :meth:`~kivy.clock.ClockBase.schedule_once`.</span>

<span class="sd">    .. note::</span>
<span class="sd">        :attr:`~kivy.uix.behaviors.FocusBehavior.keyboard_mode`,</span>
<span class="sd">        :meth:`~kivy.uix.behaviors.FocusBehavior.show_keyboard`,</span>
<span class="sd">        :meth:`~kivy.uix.behaviors.FocusBehavior.hide_keyboard`,</span>
<span class="sd">        and :attr:`~kivy.uix.behaviors.FocusBehavior.input_type`,</span>
<span class="sd">        have been removed from :class:`TextInput` since they are now inherited</span>
<span class="sd">        from :class:`~kivy.uix.behaviors.FocusBehavior`.</span>

<span class="sd">    .. versionchanged:: 1.9.0</span>
<span class="sd">        :class:`TextInput` now inherits from</span>
<span class="sd">        :class:`~kivy.uix.behaviors.FocusBehavior`.</span>

<span class="sd">    .. versionchanged:: 1.7.0</span>
<span class="sd">        `on_double_tap`, `on_triple_tap` and `on_quad_touch` events added.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">__events__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;on_text_validate&#39;</span><span class="p">,</span> <span class="s">&#39;on_double_tap&#39;</span><span class="p">,</span> <span class="s">&#39;on_triple_tap&#39;</span><span class="p">,</span>
                  <span class="s">&#39;on_quad_touch&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_focusable</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;is_focusable&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_win</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_blink_time</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_finished</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_text</span> <span class="o">=</span> <span class="s">u&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bubble</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_line_options</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keyboard_mode</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;kivy&#39;</span><span class="p">,</span> <span class="s">&#39;keyboard_mode&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_mode</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_undo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_touch_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interesting_keys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">8</span><span class="p">:</span> <span class="s">&#39;backspace&#39;</span><span class="p">,</span>
            <span class="mi">13</span><span class="p">:</span> <span class="s">&#39;enter&#39;</span><span class="p">,</span>
            <span class="mi">127</span><span class="p">:</span> <span class="s">&#39;del&#39;</span><span class="p">,</span>
            <span class="mi">271</span><span class="p">:</span> <span class="s">&#39;enter&#39;</span><span class="p">,</span>
            <span class="mi">273</span><span class="p">:</span> <span class="s">&#39;cursor_up&#39;</span><span class="p">,</span>
            <span class="mi">274</span><span class="p">:</span> <span class="s">&#39;cursor_down&#39;</span><span class="p">,</span>
            <span class="mi">275</span><span class="p">:</span> <span class="s">&#39;cursor_right&#39;</span><span class="p">,</span>
            <span class="mi">276</span><span class="p">:</span> <span class="s">&#39;cursor_left&#39;</span><span class="p">,</span>
            <span class="mi">278</span><span class="p">:</span> <span class="s">&#39;cursor_home&#39;</span><span class="p">,</span>
            <span class="mi">279</span><span class="p">:</span> <span class="s">&#39;cursor_end&#39;</span><span class="p">,</span>
            <span class="mi">280</span><span class="p">:</span> <span class="s">&#39;cursor_pgup&#39;</span><span class="p">,</span>
            <span class="mi">281</span><span class="p">:</span> <span class="s">&#39;cursor_pgdown&#39;</span><span class="p">,</span>
            <span class="mi">303</span><span class="p">:</span> <span class="s">&#39;shift_L&#39;</span><span class="p">,</span>
            <span class="mi">304</span><span class="p">:</span> <span class="s">&#39;shift_R&#39;</span><span class="p">}</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">TextInput</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_trigger_refresh_line_options</span><span class="p">,</span>
                  <span class="n">font_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_trigger_refresh_line_options</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">set_focused</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focused</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">handle_readonly</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">_is_desktop</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_copy</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_focusable</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">padding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_text_options</span><span class="p">,</span>
                  <span class="n">tab_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_text_options</span><span class="p">,</span>
                  <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_text_options</span><span class="p">,</span>
                  <span class="n">font_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_text_options</span><span class="p">,</span>
                  <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_text_options</span><span class="p">,</span>
                  <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_text_options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_trigger_update_graphics</span><span class="p">,</span> <span class="n">focus</span><span class="o">=</span><span class="n">set_focused</span><span class="p">,</span>
                  <span class="n">readonly</span><span class="o">=</span><span class="n">handle_readonly</span><span class="p">)</span>
        <span class="n">handle_readonly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_position_handles</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">create_trigger</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position_handles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_show_handles</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">create_trigger</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_handles</span><span class="p">,</span> <span class="o">.</span><span class="mo">05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_refresh_line_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_refresh_text</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_trigger_position_handles</span><span class="p">,</span>
                  <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_trigger_position_handles</span><span class="p">)</span>

        <span class="c"># when the gl context is reloaded, trigger the text rendering again.</span>
        <span class="n">_textinput_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TextInput</span><span class="o">.</span><span class="n">_reload_remove_observer</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">on_text_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="TextInput.cursor_index"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.cursor_index">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the cursor index in the text/value.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="n">lf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">cursor</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">lf</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FL_IS_NEWLINE</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">lf</span><span class="p">[</span><span class="n">cr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FL_IS_NEWLINE</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="TextInput.cursor_offset"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.cursor_offset">[docs]</a>    <span class="k">def</span> <span class="nf">cursor_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the cursor x offset on the current line.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_row</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_col</span>
        <span class="n">_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">and</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">_lines</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_width</span><span class="p">(</span>
                <span class="n">_lines</span><span class="p">[</span><span class="n">row</span><span class="p">][:</span><span class="n">col</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">offset</span>
</div>
<div class="viewcode-block" id="TextInput.get_cursor_from_index"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.get_cursor_from_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_cursor_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the (row, col) of the cursor from text index.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">lf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)):</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">lf</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FL_IS_NEWLINE</span><span class="p">:</span>
                <span class="n">ni</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ni</span> <span class="o">&gt;=</span> <span class="n">index</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">index</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ni</span>
        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span>
</div>
<div class="viewcode-block" id="TextInput.select_text"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.select_text">[docs]</a>    <span class="k">def</span> <span class="nf">select_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Select a portion of text displayed in this TextInput.</span>

<span class="sd">        .. versionadded:: 1.4.0</span>

<span class="sd">        :Parameters:</span>
<span class="sd">            `start`</span>
<span class="sd">                Index of textinput.text from where to start selection</span>
<span class="sd">            `end`</span>
<span class="sd">                Index of textinput.text till which the selection should be</span>
<span class="sd">                displayed</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="n">start</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;end must be superior to start&#39;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_finished</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_graphics_selection</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TextInput.select_all"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.select_all">[docs]</a>    <span class="k">def</span> <span class="nf">select_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Select all of the text displayed in this TextInput.</span>

<span class="sd">        .. versionadded:: 1.4.0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
</div>
    <span class="n">re_indent</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^(\s*|)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_auto_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substring</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
        <span class="n">_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">(</span><span class="n">encode</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">line_start</span> <span class="o">=</span> <span class="n">_text</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_start</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">_text</span><span class="p">[</span><span class="n">line_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">index</span><span class="p">]</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_indent</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                <span class="n">substring</span> <span class="o">+=</span> <span class="n">indent</span>
        <span class="k">return</span> <span class="n">substring</span>

<div class="viewcode-block" id="TextInput.insert_text"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.insert_text">[docs]</a>    <span class="k">def</span> <span class="nf">insert_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">substring</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Insert new text at the current cursor position. Override this</span>
<span class="sd">        function in order to pre-process text for input validation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">substring</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_filter</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">chr</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">substring</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">chr</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="n">int_pat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_int_patb</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">int_pat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_int_patu</span>

            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">:</span>
                <span class="n">substring</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">int_pat</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">substring</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;float&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;.&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="n">substring</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">int_pat</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">substring</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">substring</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">int_pat</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span>
                                          <span class="ow">in</span> <span class="n">substring</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">substring</span> <span class="o">=</span> <span class="n">mode</span><span class="p">(</span><span class="n">substring</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">substring</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hide_handles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_win</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_undo</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiline</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_indent</span> \
                <span class="ow">and</span> <span class="n">substring</span> <span class="o">==</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="n">substring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_indent</span><span class="p">(</span><span class="n">substring</span><span class="p">)</span>

        <span class="n">cc</span><span class="p">,</span> <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span>
        <span class="n">sci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span>
        <span class="n">ci</span> <span class="o">=</span> <span class="n">sci</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">cr</span><span class="p">]</span>
        <span class="n">len_str</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">substring</span><span class="p">)</span>
        <span class="n">new_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">cc</span><span class="p">]</span> <span class="o">+</span> <span class="n">substring</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">cc</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_line_text</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>

        <span class="n">wrap</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_text_width</span><span class="p">(</span>
            <span class="n">new_text</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tab_width</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">len_str</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">substring</span> <span class="o">==</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="ow">or</span> <span class="n">wrap</span><span class="p">:</span>
            <span class="c"># Avoid refreshing text on every keystroke.</span>
            <span class="c"># Allows for faster typing of text when the amount of text in</span>
            <span class="c"># TextInput gets large.</span>

            <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span>\
                <span class="n">lineflags</span><span class="p">,</span> <span class="n">len_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_line_from_cursor</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
            <span class="c"># calling trigger here could lead to wrong cursor positioning</span>
            <span class="c"># and repeating of text when keys are added rapidly in a automated</span>
            <span class="c"># fashion. From Android Keyboard for example.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text_from_property</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span>
                                             <span class="n">lineflags</span><span class="p">,</span> <span class="n">len_lines</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span><span class="p">(</span><span class="n">ci</span> <span class="o">+</span> <span class="n">len_str</span><span class="p">)</span>
        <span class="c"># handle undo and redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_unredo_insert</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">ci</span> <span class="o">+</span> <span class="n">len_str</span><span class="p">,</span> <span class="n">substring</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_line_from_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">new_text</span><span class="p">):</span>
        <span class="c"># get current paragraph from cursor position</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="n">linesflags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">linesflags</span><span class="p">[</span><span class="n">start</span><span class="p">]:</span>
            <span class="n">start</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">new_text</span> <span class="o">=</span> <span class="s">u&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">lines</span><span class="p">[</span><span class="n">start</span><span class="p">],</span> <span class="n">new_text</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">linesflags</span><span class="p">[</span><span class="n">finish</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">new_text</span> <span class="o">=</span> <span class="s">u&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">new_text</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">finish</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="n">finish</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">lines</span><span class="p">,</span> <span class="n">lineflags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_smart</span><span class="p">(</span><span class="n">new_text</span><span class="p">)</span>
        <span class="n">len_lines</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">lineflags</span><span class="p">,</span> <span class="n">len_lines</span>

    <span class="k">def</span> <span class="nf">_set_unredo_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">sci</span><span class="p">,</span> <span class="n">substring</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">):</span>
        <span class="c"># handle undo and redo</span>
        <span class="k">if</span> <span class="n">from_undo</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;undo_command&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">sci</span><span class="p">),</span>
                           <span class="s">&#39;redo_command&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">substring</span><span class="p">)})</span>
        <span class="c"># reset redo when undo is appended to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_redo</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="TextInput.reset_undo"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.reset_undo">[docs]</a>    <span class="k">def</span> <span class="nf">reset_undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reset undo and redo lists from memory.</span>

<span class="sd">        .. versionadded:: 1.3.0</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_redo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undo</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="TextInput.do_redo"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.do_redo">[docs]</a>    <span class="k">def</span> <span class="nf">do_redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Do redo operation.</span>

<span class="sd">        .. versionadded:: 1.3.0</span>

<span class="sd">        This action re-does any command that has been un-done by</span>
<span class="sd">        do_undo/ctrl+z.  This function is automatically called when</span>
<span class="sd">        `ctrl+r` keys are pressed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redo</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">undo_type</span> <span class="o">=</span> <span class="n">x_item</span><span class="p">[</span><span class="s">&#39;undo_command&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_get_cusror_from_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span>

            <span class="k">if</span> <span class="n">undo_type</span> <span class="o">==</span> <span class="s">&#39;insert&#39;</span><span class="p">:</span>
                <span class="n">ci</span><span class="p">,</span> <span class="n">substring</span> <span class="o">=</span> <span class="n">x_item</span><span class="p">[</span><span class="s">&#39;redo_command&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">_get_cusror_from_index</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">substring</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">undo_type</span> <span class="o">==</span> <span class="s">&#39;bkspc&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">_get_cusror_from_index</span><span class="p">(</span><span class="n">x_item</span><span class="p">[</span><span class="s">&#39;redo_command&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">do_backspace</span><span class="p">(</span><span class="n">from_undo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># delsel</span>
                <span class="n">ci</span><span class="p">,</span> <span class="n">sci</span> <span class="o">=</span> <span class="n">x_item</span><span class="p">[</span><span class="s">&#39;redo_command&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="n">ci</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="n">sci</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">_get_cusror_from_index</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_item</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c"># reached at top of undo list</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TextInput.do_undo"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.do_undo">[docs]</a>    <span class="k">def</span> <span class="nf">do_undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Do undo operation.</span>

<span class="sd">        .. versionadded:: 1.3.0</span>

<span class="sd">        This action un-does any edits that have been made since the last</span>
<span class="sd">        call to reset_undo().</span>
<span class="sd">        This function is automatically called when `ctrl+z` keys are pressed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">undo_type</span> <span class="o">=</span> <span class="n">x_item</span><span class="p">[</span><span class="s">&#39;undo_command&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span><span class="p">(</span><span class="n">x_item</span><span class="p">[</span><span class="s">&#39;undo_command&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">undo_type</span> <span class="o">==</span> <span class="s">&#39;insert&#39;</span><span class="p">:</span>
                <span class="n">ci</span><span class="p">,</span> <span class="n">sci</span> <span class="o">=</span> <span class="n">x_item</span><span class="p">[</span><span class="s">&#39;undo_command&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="n">ci</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="n">sci</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">undo_type</span> <span class="o">==</span> <span class="s">&#39;bkspc&#39;</span><span class="p">:</span>
                <span class="n">substring</span> <span class="o">=</span> <span class="n">x_item</span><span class="p">[</span><span class="s">&#39;undo_command&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">substring</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># delsel</span>
                <span class="n">substring</span> <span class="o">=</span> <span class="n">x_item</span><span class="p">[</span><span class="s">&#39;undo_command&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">substring</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_item</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c"># reached at top of undo list</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TextInput.do_backspace"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.do_backspace">[docs]</a>    <span class="k">def</span> <span class="nf">do_backspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;bkspc&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Do backspace operation from the current cursor position.</span>
<span class="sd">        This action might do several things:</span>

<span class="sd">            - removing the current selection if available.</span>
<span class="sd">            - removing the previous char and move the cursor back.</span>
<span class="sd">            - do nothing, if we are at the start.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">cc</span><span class="p">,</span> <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span>
        <span class="n">_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_lines</span><span class="p">[</span><span class="n">cr</span><span class="p">]</span>
        <span class="n">cursor_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
        <span class="n">text_last_line</span> <span class="o">=</span> <span class="n">_lines</span><span class="p">[</span><span class="n">cr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cc</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">_lines_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">cr</span>
        <span class="k">if</span> <span class="n">cc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">substring</span> <span class="o">=</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="n">_lines_flags</span><span class="p">[</span><span class="n">cr</span><span class="p">]</span> <span class="k">else</span> <span class="s">u&#39; &#39;</span>
            <span class="n">new_text</span> <span class="o">=</span> <span class="n">text_last_line</span> <span class="o">+</span> <span class="n">text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_line_text</span><span class="p">(</span><span class="n">cr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_line</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">cr</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#ch = text[cc-1]</span>
            <span class="n">substring</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">cc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">new_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">cc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">cc</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_line_text</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>

        <span class="c"># refresh just the current line instead of the whole text</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">lineflags</span><span class="p">,</span> <span class="n">len_lines</span> <span class="o">=</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_line_from_cursor</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">new_text</span><span class="p">)</span>
        <span class="c"># avoid trigger refresh, leads to issue with</span>
        <span class="c"># keys/text send rapidly through code.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text_from_property</span><span class="p">(</span><span class="s">&#39;del&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span>
                                         <span class="n">lineflags</span><span class="p">,</span> <span class="n">len_lines</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span><span class="p">(</span><span class="n">cursor_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c"># handle undo and redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_undo_redo_bkspc</span><span class="p">(</span>
            <span class="n">cursor_index</span><span class="p">,</span>
            <span class="n">cursor_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">substring</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_set_undo_redo_bkspc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ol_index</span><span class="p">,</span> <span class="n">new_index</span><span class="p">,</span> <span class="n">substring</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">):</span>
        <span class="c"># handle undo and redo for backspace</span>
        <span class="k">if</span> <span class="n">from_undo</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s">&#39;undo_command&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;bkspc&#39;</span><span class="p">,</span> <span class="n">new_index</span><span class="p">,</span> <span class="n">substring</span><span class="p">),</span>
            <span class="s">&#39;redo_command&#39;</span><span class="p">:</span> <span class="n">ol_index</span><span class="p">})</span>
        <span class="c">#reset redo when undo is appended to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_redo</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="TextInput.do_cursor_movement"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.do_cursor_movement">[docs]</a>    <span class="k">def</span> <span class="nf">do_cursor_movement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Move the cursor relative to it&#39;s current position.</span>
<span class="sd">        Action can be one of :</span>

<span class="sd">            - cursor_left: move the cursor to the left</span>
<span class="sd">            - cursor_right: move the cursor to the right</span>
<span class="sd">            - cursor_up: move the cursor on the previous line</span>
<span class="sd">            - cursor_down: move the cursor on the next line</span>
<span class="sd">            - cursor_home: move the cursor at the start of the current line</span>
<span class="sd">            - cursor_end: move the cursor at the end of current line</span>
<span class="sd">            - cursor_pgup: move one &quot;page&quot; before</span>
<span class="sd">            - cursor_pgdown: move one &quot;page&quot; after</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">pgmove_speed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_spacing</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cursor_up&#39;</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">col</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cursor_down&#39;</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">col</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cursor_left&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">:</span>
                    <span class="n">row</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cursor_right&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">row</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cursor_home&#39;</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cursor_end&#39;</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cursor_pgup&#39;</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">-</span> <span class="n">pgmove_speed</span><span class="p">)</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">col</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;cursor_pgdown&#39;</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">pgmove_speed</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">row</span><span class="p">]),</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TextInput.get_cursor_from_xy"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.get_cursor_from_xy">[docs]</a>    <span class="k">def</span> <span class="nf">get_cursor_from_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the (row, col) of the cursor from an (x, y) position.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">padding_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">padding_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_spacing</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">scrl_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span>
        <span class="n">scrl_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span>
        <span class="n">scrl_y</span> <span class="o">=</span> <span class="n">scrl_y</span> <span class="o">/</span> <span class="n">dy</span> <span class="k">if</span> <span class="n">scrl_y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">-</span> <span class="n">padding_top</span> <span class="o">+</span> <span class="n">scrl_y</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">boundary</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cy</span> <span class="o">/</span> <span class="n">dy</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">dcx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">_get_text_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_width</span>
        <span class="n">_tab_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_width</span>
        <span class="n">_label_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">cy</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_get_text_width</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">cy</span><span class="p">][:</span><span class="n">i</span><span class="p">],</span>
                               <span class="n">_tab_width</span><span class="p">,</span>
                               <span class="n">_label_cached</span><span class="p">)</span> <span class="o">+</span> <span class="n">padding_left</span> <span class="o">&gt;=</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">scrl_x</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">dcx</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">dcx</span>
        <span class="k">return</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span>

    <span class="c">#</span>
    <span class="c"># Selection control</span>
    <span class="c">#</span></div>
<div class="viewcode-block" id="TextInput.cancel_selection"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.cancel_selection">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Cancel current selection (if any).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_finished</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_update_graphics</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TextInput.delete_selection"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.delete_selection">[docs]</a>    <span class="k">def</span> <span class="nf">delete_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Delete the current text selection (if any).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">readonly</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hide_handles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_win</span><span class="p">)</span>
        <span class="n">scrl_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span>
        <span class="n">scrl_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span>
        <span class="n">cc</span><span class="p">,</span> <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">(</span><span class="n">encode</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">cursor</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">cur_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]][:</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">finish</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">finish</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span>
        <span class="n">lines</span><span class="p">,</span> <span class="n">lineflags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_smart</span><span class="p">(</span><span class="n">cur_line</span><span class="p">)</span>
        <span class="n">len_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">finish</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_line_text</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cur_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text_from_property</span><span class="p">(</span><span class="s">&#39;del&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">finish</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lines</span><span class="p">,</span>
                                             <span class="n">lineflags</span><span class="p">,</span> <span class="n">len_lines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">=</span> <span class="n">scrl_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span> <span class="o">=</span> <span class="n">scrl_y</span>
        <span class="c"># handle undo and redo for delete selecttion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_unredo_delsel</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">a</span><span class="p">:</span><span class="n">b</span><span class="p">],</span> <span class="n">from_undo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_selection</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_set_unredo_delsel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">substring</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">):</span>
        <span class="c"># handle undo and redo for backspace</span>
        <span class="k">if</span> <span class="n">from_undo</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_undo</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s">&#39;undo_command&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;delsel&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">substring</span><span class="p">),</span>
            <span class="s">&#39;redo_command&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)})</span>
        <span class="c"># reset redo when undo is appended to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_redo</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_update_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">finished</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Update selection text and order of from/to if finished is True.</span>
<span class="sd">        Can be called multiple times until finished is True.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_finished</span> <span class="o">=</span> <span class="n">finished</span>
        <span class="n">_selection_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">(</span><span class="n">encode</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="n">a</span><span class="p">:</span><span class="n">b</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selection_text</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_copy</span> <span class="k">else</span>
                               <span class="p">((</span><span class="s">&#39;*&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="k">else</span>
                                <span class="n">_selection_text</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">finished</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_selection_text</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># update graphics only on new line</span>
            <span class="c"># allows smoother scrolling, noticeably</span>
            <span class="c"># faster when dealing with large text.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_graphics_selection</span><span class="p">()</span>
            <span class="c">#self._trigger_update_graphics()</span>

    <span class="c">#</span>
    <span class="c"># Touch control</span>
    <span class="c">#</span>
    <span class="k">def</span> <span class="nf">long_touch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_cut_copy_paste</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_long_touch_pos</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_win</span><span class="p">,</span>
                                      <span class="n">mode</span><span class="o">=</span><span class="s">&#39;paste&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TextInput.on_double_tap"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.on_double_tap">[docs]</a>    <span class="k">def</span> <span class="nf">on_double_tap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This event is dispatched when a double tap happens</span>
<span class="sd">        inside TextInput. The default behavior is to select the</span>
<span class="sd">        word around the current cursor position. Override this to provide</span>
<span class="sd">        different behavior. Alternatively, you can bind to this</span>
<span class="sd">        event to provide additional functionality.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_col</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_row</span><span class="p">]</span>
        <span class="n">len_line</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="n">cc</span><span class="p">])</span> <span class="o">-</span> <span class="n">line</span><span class="p">[:</span><span class="n">cc</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">u&#39; &#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">cc</span><span class="p">:]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">u&#39; &#39;</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">end</span> <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">len_line</span> <span class="o">-</span> <span class="n">cc</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_text</span><span class="p">(</span><span class="n">ci</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="n">ci</span> <span class="o">+</span> <span class="n">end</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TextInput.on_triple_tap"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.on_triple_tap">[docs]</a>    <span class="k">def</span> <span class="nf">on_triple_tap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This event is dispatched when a triple tap happens</span>
<span class="sd">        inside TextInput. The default behavior is to select the</span>
<span class="sd">        line around current cursor position. Override this to provide</span>
<span class="sd">        different behavior. Alternatively, you can bind to this</span>
<span class="sd">        event to provide additional functionality.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_col</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_row</span><span class="p">]</span>
        <span class="n">len_line</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">select_text</span><span class="p">(</span><span class="n">ci</span> <span class="o">-</span> <span class="n">cc</span><span class="p">,</span> <span class="n">ci</span> <span class="o">+</span> <span class="p">(</span><span class="n">len_line</span> <span class="o">-</span> <span class="n">cc</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TextInput.on_quad_touch"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.on_quad_touch">[docs]</a>    <span class="k">def</span> <span class="nf">on_quad_touch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This event is dispatched when four fingers are touching</span>
<span class="sd">        inside TextInput. The default behavior is to select all text.</span>
<span class="sd">        Override this to provide different behavior. Alternatively,</span>
<span class="sd">        you can bind to this event to provide additional functionality.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_all</span><span class="p">())</span>
</div>
    <span class="k">def</span> <span class="nf">on_touch_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">on_touch_down</span><span class="p">(</span><span class="n">touch</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>

        <span class="n">touch_pos</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">pos</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">collide_point</span><span class="p">(</span><span class="o">*</span><span class="n">touch_pos</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">super</span><span class="p">(</span><span class="n">TextInput</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">on_touch_down</span><span class="p">(</span><span class="n">touch</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="c"># Check for scroll wheel</span>
        <span class="k">if</span> <span class="s">&#39;button&#39;</span> <span class="ow">in</span> <span class="n">touch</span><span class="o">.</span><span class="n">profile</span> <span class="ow">and</span> <span class="n">touch</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;scroll&#39;</span><span class="p">):</span>
            <span class="n">scroll_type</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">button</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">scroll_type</span> <span class="o">==</span> <span class="s">&#39;down&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
            <span class="k">if</span> <span class="n">scroll_type</span> <span class="o">==</span> <span class="s">&#39;up&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span><span class="p">):</span>
                        <span class="k">return</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">&gt;=</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">texture</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="k">return</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>

        <span class="n">touch</span><span class="o">.</span><span class="n">grab</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_touch_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">touch</span><span class="o">.</span><span class="n">is_double_tap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&#39;on_double_tap&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">touch</span><span class="o">.</span><span class="n">is_triple_tap</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&#39;on_triple_tap&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_touch_count</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&#39;on_quad_touch&#39;</span><span class="p">)</span>

        <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">win</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_win</span> <span class="o">=</span> <span class="n">win</span> <span class="o">=</span> <span class="n">EventLoop</span><span class="o">.</span><span class="n">window</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">win</span><span class="p">:</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Textinput: &#39;</span>
                           <span class="s">&#39;Cannot show bubble, unable to get root window&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hide_cut_copy_paste</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_win</span><span class="p">)</span>
        <span class="c"># schedule long touch for paste</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_touch_pos</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_touch</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_xy</span><span class="p">(</span><span class="o">*</span><span class="n">touch_pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel_selection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span> <span class="o">=</span> <span class="n">touch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">on_touch_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">touch</span><span class="o">.</span><span class="n">grab_current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">:</span>
            <span class="n">touch</span><span class="o">.</span><span class="n">ungrab</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span> <span class="ow">is</span> <span class="n">touch</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span> <span class="ow">is</span> <span class="n">touch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_xy</span><span class="p">(</span><span class="n">touch</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">touch</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">on_touch_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">touch</span><span class="o">.</span><span class="n">grab_current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">touch</span><span class="o">.</span><span class="n">ungrab</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_touch_count</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c"># schedule long touch for paste</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">long_touch</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_touch</span> <span class="ow">is</span> <span class="n">touch</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="c"># show Bubble</span>
            <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_cut_copy_paste</span><span class="p">(</span><span class="n">touch</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">win</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_handles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hide_handles</span><span class="p">()</span>
                <span class="n">handle_middle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span>
                <span class="k">if</span> <span class="n">handle_middle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span> <span class="o">=</span> <span class="n">handle_middle</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">(</span>
                        <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_image_middle</span><span class="p">,</span>
                        <span class="n">window</span><span class="o">=</span><span class="n">win</span><span class="p">,</span>
                        <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;45dp&#39;</span><span class="p">,</span> <span class="s">&#39;45dp&#39;</span><span class="p">))</span>
                    <span class="n">handle_middle</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_press</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_pressed</span><span class="p">,</span>
                                       <span class="n">on_touch_move</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_move</span><span class="p">,</span>
                                       <span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_released</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span><span class="o">.</span><span class="n">parent</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">handle_middle</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="s">&#39;after&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_position_handles</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;middle&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_handle_pressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hide_cut_copy_paste</span><span class="p">()</span>
        <span class="n">sf</span><span class="p">,</span> <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_to</span>
        <span class="k">if</span> <span class="n">sf</span> <span class="o">&gt;</span> <span class="n">st</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="n">st</span><span class="p">,</span> <span class="n">sf</span>

    <span class="k">def</span> <span class="nf">_handle_released</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="n">sf</span><span class="p">,</span> <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_to</span>
        <span class="k">if</span> <span class="n">sf</span> <span class="o">==</span> <span class="n">st</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_cut_copy_paste</span><span class="p">(</span>
            <span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">center_x</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">top</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">touch</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">touch</span><span class="o">.</span><span class="n">grab_current</span> <span class="o">!=</span> <span class="n">instance</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">get_cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_xy</span>
        <span class="n">handle_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span>
        <span class="n">handle_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span>
        <span class="n">handle_middle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">get_cursor</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="n">_touch_diff</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">instance</span> <span class="o">!=</span> <span class="n">touch</span><span class="o">.</span><span class="n">grab_current</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">handle_middle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">cursor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position_handles</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;middle&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">(</span><span class="n">cursor</span><span class="o">=</span><span class="n">cursor</span><span class="p">)</span>
        <span class="n">sf</span><span class="p">,</span> <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_to</span>

        <span class="k">if</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">handle_left</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="n">ci</span>
        <span class="k">elif</span> <span class="n">instance</span> <span class="o">==</span> <span class="n">handle_right</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="n">ci</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_update_graphics</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_position_handles</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_position_handles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">,</span> <span class="s">&#39;both&#39;</span><span class="p">)</span>

        <span class="n">lh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>

        <span class="n">handle_middle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span>
        <span class="k">if</span> <span class="n">handle_middle</span><span class="p">:</span>
            <span class="n">hp_mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_pos</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">hp_mid</span>
            <span class="n">handle_middle</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">handle_middle</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">handle_middle</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lh</span>
        <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;m&#39;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="s">&#39;selection&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_window</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span><span class="p">)</span>

        <span class="n">handle_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">handle_left</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">hp_left</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span>
        <span class="n">handle_left</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">hp_left</span>
        <span class="n">handle_left</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">handle_left</span><span class="o">.</span><span class="n">width</span>
        <span class="n">handle_left</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">handle_left</span><span class="o">.</span><span class="n">height</span>

        <span class="n">handle_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span>
        <span class="n">last_rect</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hp_right</span> <span class="o">=</span> <span class="n">last_rect</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">last_rect</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hp_right</span>
        <span class="n">handle_right</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">last_rect</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">handle_right</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">handle_right</span><span class="o">.</span><span class="n">height</span>

    <span class="k">def</span> <span class="nf">_hide_handles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">win</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span>
        <span class="k">if</span> <span class="n">win</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_show_handles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_handles</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">win</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_window</span><span class="p">()</span>
            <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span>

        <span class="n">handle_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span>
        <span class="n">handle_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span> <span class="o">=</span> <span class="n">handle_left</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_image_left</span><span class="p">,</span>
                <span class="n">window</span><span class="o">=</span><span class="n">win</span><span class="p">,</span>
                <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;45dp&#39;</span><span class="p">,</span> <span class="s">&#39;45dp&#39;</span><span class="p">))</span>
            <span class="n">handle_left</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_press</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_pressed</span><span class="p">,</span>
                             <span class="n">on_touch_move</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_move</span><span class="p">,</span>
                             <span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_released</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span> <span class="o">=</span> <span class="n">handle_right</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_image_right</span><span class="p">,</span>
                <span class="n">window</span><span class="o">=</span><span class="n">win</span><span class="p">,</span>
                <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;45dp&#39;</span><span class="p">,</span> <span class="s">&#39;45dp&#39;</span><span class="p">))</span>
            <span class="n">handle_right</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_press</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_pressed</span><span class="p">,</span>
                              <span class="n">on_touch_move</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_move</span><span class="p">,</span>
                              <span class="n">on_release</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_released</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_position_handles</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_position_handles</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_from</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_to</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="s">&#39;after&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="s">&#39;after&#39;</span><span class="p">)</span>
            <span class="n">anim</span> <span class="o">=</span> <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">anim</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span><span class="p">)</span>
            <span class="n">anim</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_show_cut_copy_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">parent_changed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">pos_in_window</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">*</span><span class="n">l</span><span class="p">):</span>
        <span class="c"># Show a bubble with cut copy and paste buttons</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bubble</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">bubble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bubble</span>
        <span class="k">if</span> <span class="n">bubble</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bubble</span> <span class="o">=</span> <span class="n">bubble</span> <span class="o">=</span> <span class="n">TextInputCutCopyPaste</span><span class="p">(</span><span class="n">textinput</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_cut_copy_paste</span><span class="p">,</span>
                                     <span class="n">pos</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_win</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hide_cut_copy_paste</span><span class="p">(</span><span class="n">win</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">cursor_pos</span><span class="o">=</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hide_cut_copy_paste</span><span class="p">(</span><span class="n">win</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="n">bubble</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">if</span> <span class="n">parent_changed</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Search the position from the touch to the window</span>
        <span class="n">lh</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_spacing</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">t_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos_in_window</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_window</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">bubble_size</span> <span class="o">=</span> <span class="n">bubble</span><span class="o">.</span><span class="n">size</span>
        <span class="n">bubble_hw</span> <span class="o">=</span> <span class="n">bubble_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">win_size</span> <span class="o">=</span> <span class="n">win</span><span class="o">.</span><span class="n">size</span>
        <span class="n">bubble_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">inch</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">bubble_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bubble_hw</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># bubble beyond left of window</span>
            <span class="k">if</span> <span class="n">bubble_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">win_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bubble_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="c"># bubble above window height</span>
                <span class="n">bubble_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">bubble_hw</span><span class="p">,</span> <span class="p">(</span><span class="n">t_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">lh</span> <span class="o">+</span> <span class="n">ls</span> <span class="o">+</span> <span class="n">inch</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">)))</span>
                <span class="n">bubble</span><span class="o">.</span><span class="n">arrow_pos</span> <span class="o">=</span> <span class="s">&#39;top_left&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bubble_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">bubble_hw</span><span class="p">,</span> <span class="n">bubble_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">bubble</span><span class="o">.</span><span class="n">arrow_pos</span> <span class="o">=</span> <span class="s">&#39;bottom_left&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">bubble_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">bubble_hw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">win_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c"># bubble beyond right of window</span>
            <span class="k">if</span> <span class="n">bubble_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">win_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bubble_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="c"># bubble above window height</span>
                <span class="n">bubble_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">win_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bubble_hw</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">t_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">lh</span> <span class="o">+</span> <span class="n">ls</span> <span class="o">+</span> <span class="n">inch</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">)))</span>
                <span class="n">bubble</span><span class="o">.</span><span class="n">arrow_pos</span> <span class="o">=</span> <span class="s">&#39;top_right&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bubble_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">win_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bubble_hw</span><span class="p">,</span> <span class="n">bubble_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">bubble</span><span class="o">.</span><span class="n">arrow_pos</span> <span class="o">=</span> <span class="s">&#39;bottom_right&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bubble_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">win_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bubble_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="c"># bubble above window height</span>
                <span class="n">bubble_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">bubble_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                             <span class="p">(</span><span class="n">t_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">lh</span> <span class="o">+</span> <span class="n">ls</span> <span class="o">+</span> <span class="n">inch</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">)))</span>
                <span class="n">bubble</span><span class="o">.</span><span class="n">arrow_pos</span> <span class="o">=</span> <span class="s">&#39;top_mid&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bubble</span><span class="o">.</span><span class="n">arrow_pos</span> <span class="o">=</span> <span class="s">&#39;bottom_mid&#39;</span>

        <span class="n">bubble_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_widget</span><span class="p">(</span><span class="o">*</span><span class="n">bubble_pos</span><span class="p">)</span>
        <span class="n">bubble</span><span class="o">.</span><span class="n">center_x</span> <span class="o">=</span> <span class="n">bubble_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">bubble</span><span class="o">.</span><span class="n">arrow_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;t&#39;</span><span class="p">:</span>
            <span class="n">bubble</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">bubble_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bubble</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">bubble_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bubble</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="n">Animation</span><span class="o">.</span><span class="n">cancel_all</span><span class="p">(</span><span class="n">bubble</span><span class="p">)</span>
        <span class="n">bubble</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">bubble</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="s">&#39;after&#39;</span><span class="p">)</span>
        <span class="n">Animation</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">225</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">bubble</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hide_cut_copy_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">bubble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bubble</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bubble</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">bubble</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="c">#</span>
    <span class="c"># Private</span>
    <span class="c">#</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_reload_remove_observer</span><span class="p">(</span><span class="n">wr</span><span class="p">):</span>
        <span class="c"># called when the textinput is deleted</span>
        <span class="k">if</span> <span class="n">wr</span> <span class="ow">in</span> <span class="n">_textinput_list</span><span class="p">:</span>
            <span class="n">_textinput_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_focused</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">win</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_win</span> <span class="o">=</span> <span class="n">win</span> <span class="o">=</span> <span class="n">EventLoop</span><span class="o">.</span><span class="n">window</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">win</span><span class="p">:</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Textinput: unable to get root window&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel_selection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hide_cut_copy_paste</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">readonly</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">disabled</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_is_desktop</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_keyboard_mode</span> <span class="o">==</span> <span class="s">&#39;system&#39;</span><span class="p">):</span>
                <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_blink_cursor</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_editable</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_editable</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_blink_cursor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hide_handles</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_win</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_ensure_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">Clipboard</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Clipboard</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">kivy.core.clipboard</span> <span class="kn">import</span> <span class="n">Clipboard</span>

<div class="viewcode-block" id="TextInput.cut"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Copy current selection to clipboard then delete it from TextInput.</span>

<span class="sd">        .. versionadded:: 1.8.0</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_text</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_clipboard</span><span class="p">()</span>
        <span class="n">Clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">()</span>

<div class="viewcode-block" id="TextInput.copy"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Copy the value provided in argument `data` into current clipboard.</span>
<span class="sd">        If data is not of type string it will be converted to string.</span>
<span class="sd">        If no data is provided then current selection if present is copied.</span>

<span class="sd">        .. versionadded:: 1.8.0</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_clipboard</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TextInput.paste"><a class="viewcode-back" href="../../../api-kivy.uix.textinput.html#kivy.uix.textinput.TextInput.paste">[docs]</a>    <span class="k">def</span> <span class="nf">paste</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Insert text from system :class:`~kivy.core.clipboard.Clipboard`</span>
<span class="sd">        into the :class:`~kivy.uix.textinput.TextInput` at current cursor</span>
<span class="sd">        position.</span>

<span class="sd">        .. versionadded:: 1.8.0</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_clipboard</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Clipboard</span><span class="o">.</span><span class="n">paste</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_text_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">tab_width</span><span class="p">,</span> <span class="n">_label_cached</span><span class="p">):</span>
        <span class="c"># Return the width of a text, according to the current line options</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_line_options</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cid</span> <span class="o">=</span> <span class="s">u&#39;{}</span><span class="se">\0</span><span class="s">{}</span><span class="se">\0</span><span class="s">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">cid</span> <span class="o">=</span> <span class="s">&#39;{}</span><span class="se">\0</span><span class="s">{}</span><span class="se">\0</span><span class="s">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>

        <span class="n">width</span> <span class="o">=</span> <span class="n">Cache_get</span><span class="p">(</span><span class="s">&#39;textinput.width&#39;</span><span class="p">,</span> <span class="n">cid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">width</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">width</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_label_cached</span><span class="p">:</span>
            <span class="n">_label_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">tab_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">_label_cached</span><span class="o">.</span><span class="n">get_extents</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">_label_cached</span><span class="o">.</span><span class="n">get_extents</span><span class="p">(</span><span class="s">&#39;*&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Cache_append</span><span class="p">(</span><span class="s">&#39;textinput.width&#39;</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">width</span>

    <span class="k">def</span> <span class="nf">_do_blink_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="c"># Callback called by the timer to blink the cursor, according to the</span>
        <span class="c"># last activity in the widget</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">Clock</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_blink_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor_blink</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">on_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c"># When the cursor is moved, reset the activity timer, and update all</span>
        <span class="c"># the graphics.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cursor_blink_time</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_update_graphics</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_delete_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c"># Delete current line, and fix cursor position</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_labels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span>

    <span class="k">def</span> <span class="nf">_set_line_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="c"># Set current line with other text than the default one.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines_labels</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_line_label</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">_trigger_refresh_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_line_options</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_line_options</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_refresh_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_line_options</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_line_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text_from_property</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_hint_text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_trigger_refresh_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">largs</span><span class="p">)</span> <span class="ow">and</span> <span class="n">largs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">largs</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text_from_property</span><span class="p">(</span><span class="o">*</span><span class="n">largs</span><span class="p">))</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text_from_property</span><span class="p">(</span><span class="o">*</span><span class="n">largs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_update_text_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="n">Cache_remove</span><span class="p">(</span><span class="s">&#39;textinput.width&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_refresh_text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_refresh_text_from_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text_from_property</span><span class="p">(</span><span class="o">*</span><span class="n">largs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_refresh_text_from_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">(</span><span class="n">encode</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="o">*</span><span class="n">largs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_refresh_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="c"># Refresh all the lines from a new text.</span>
        <span class="c"># By using cache in internal functions, this method should be fast.</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">largs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">mode</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">_lines</span><span class="p">,</span> <span class="n">_lines_flags</span><span class="p">,</span> <span class="n">len_lines</span> <span class="o">=</span> <span class="n">largs</span>
            <span class="c">#start = max(0, start)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
            <span class="n">_lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_smart</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">_lines_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_line_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_create_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_line_label</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_lines</span><span class="p">:</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="n">_create_label</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">_lines_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
            <span class="n">_line_rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">lbl</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines_labels</span> <span class="o">=</span> <span class="n">_lines_labels</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span> <span class="o">=</span> <span class="n">_line_rects</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="o">=</span> <span class="n">_lines</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;del&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">finish</span> <span class="o">&gt;</span> <span class="n">start</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_insert_lines</span><span class="p">(</span><span class="n">start</span><span class="p">,</span>
                                   <span class="n">finish</span> <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">finish</span> <span class="k">else</span> <span class="p">(</span><span class="n">finish</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                   <span class="n">len_lines</span><span class="p">,</span> <span class="n">_lines_flags</span><span class="p">,</span>
                                   <span class="n">_lines</span><span class="p">,</span> <span class="n">_lines_labels</span><span class="p">,</span> <span class="n">_line_rects</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;insert&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_insert_lines</span><span class="p">(</span>
                <span class="n">start</span><span class="p">,</span>
                <span class="n">finish</span> <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">==</span> <span class="n">finish</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">len_lines</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">(</span><span class="n">finish</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">len_lines</span><span class="p">,</span> <span class="n">_lines_flags</span><span class="p">,</span> <span class="n">_lines</span><span class="p">,</span> <span class="n">_lines_labels</span><span class="p">,</span>
                <span class="n">_line_rects</span><span class="p">)</span>

        <span class="n">min_line_ht</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span><span class="o">.</span><span class="n">get_extents</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># with markup texture can be of height `1`</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">_lines_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">min_line_ht</span><span class="p">)</span>
        <span class="c">#self.line_spacing = 2</span>
        <span class="c"># now, if the text change, maybe the cursor is not at the same place as</span>
        <span class="c"># before. so, try to set the cursor on the good place</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
                                                 <span class="k">if</span> <span class="n">cursor</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">cursor</span><span class="p">)</span>
        <span class="c"># if we back to a new line, reset the scroll, otherwise, the effect is</span>
        <span class="c"># ugly</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_row</span> <span class="o">!=</span> <span class="n">row</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># with the new text don&#39;t forget to update graphics again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_update_graphics</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_insert_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">len_lines</span><span class="p">,</span> <span class="n">_lines_flags</span><span class="p">,</span>
                      <span class="n">_lines</span><span class="p">,</span> <span class="n">_lines_labels</span><span class="p">,</span> <span class="n">_line_rects</span><span class="p">):</span>
            <span class="n">self_lines_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span>
            <span class="n">_lins_flags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">_lins_flags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">self_lines_flags</span><span class="p">[:</span><span class="n">start</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">len_lines</span><span class="p">:</span>
                <span class="c"># if not inserting at first line then</span>
                <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
                    <span class="c"># make sure line flags restored for first line</span>
                    <span class="c"># _split_smart assumes first line to be not a new line</span>
                    <span class="n">_lines_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">self_lines_flags</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>
                <span class="n">_lins_flags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_lines_flags</span><span class="p">)</span>
            <span class="n">_lins_flags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">self_lines_flags</span><span class="p">[</span><span class="n">finish</span><span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span> <span class="o">=</span> <span class="n">_lins_flags</span>

            <span class="n">_lins_lbls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">_lins_lbls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines_labels</span><span class="p">[:</span><span class="n">start</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">len_lines</span><span class="p">:</span>
                <span class="n">_lins_lbls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_lines_labels</span><span class="p">)</span>
            <span class="n">_lins_lbls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines_labels</span><span class="p">[</span><span class="n">finish</span><span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines_labels</span> <span class="o">=</span> <span class="n">_lins_lbls</span>

            <span class="n">_lins_rcts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">_lins_rcts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span><span class="p">[:</span><span class="n">start</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">len_lines</span><span class="p">:</span>
                <span class="n">_lins_rcts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_line_rects</span><span class="p">)</span>
            <span class="n">_lins_rcts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span><span class="p">[</span><span class="n">finish</span><span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span> <span class="o">=</span> <span class="n">_lins_rcts</span>

            <span class="n">_lins</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">_lins</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[:</span><span class="n">start</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">len_lines</span><span class="p">:</span>
                <span class="n">_lins</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_lines</span><span class="p">)</span>
            <span class="n">_lins</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="n">finish</span><span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="o">=</span> <span class="n">_lins</span>

    <span class="k">def</span> <span class="nf">_trigger_update_graphics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">unschedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_graphics</span><span class="p">)</span>
        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_graphics</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_graphics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="c"># Update all the graphics according to the current internal values.</span>
        <span class="c">#</span>
        <span class="c"># This is a little bit complex, cause we have to :</span>
        <span class="c">#     - handle scroll_x</span>
        <span class="c">#     - handle padding</span>
        <span class="c">#     - create rectangle for the lines matching the viewport</span>
        <span class="c">#     - crop the texture coordinates to match the viewport</span>
        <span class="c">#</span>
        <span class="c"># This is the first step of graphics, the second is the selection.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">add</span>

        <span class="n">lh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">lh</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_spacing</span>

        <span class="c"># adjust view if the cursor is going outside the bounds</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span>

        <span class="c"># draw labels</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="n">rects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_rects</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_labels</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_lines</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_labels</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="n">padding_left</span><span class="p">,</span> <span class="n">padding_top</span><span class="p">,</span> <span class="n">padding_right</span><span class="p">,</span> <span class="n">padding_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">padding_left</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">-</span> <span class="n">padding_top</span> <span class="o">+</span> <span class="n">sy</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">padding_bottom</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">-</span> <span class="n">padding_top</span>
        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">miny</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">maxy</span> <span class="o">+</span> <span class="n">dy</span><span class="p">:</span>
                <span class="n">texture</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">texture</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
                <span class="n">texc</span> <span class="o">=</span> <span class="n">texture</span><span class="o">.</span><span class="n">tex_coords</span><span class="p">[:]</span>

                <span class="c"># calcul coordinate</span>
                <span class="n">viewport_pos</span> <span class="o">=</span> <span class="n">sx</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">vw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">padding_left</span> <span class="o">-</span> <span class="n">padding_right</span>
                <span class="n">vh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">padding_top</span> <span class="o">-</span> <span class="n">padding_bottom</span>
                <span class="n">tw</span><span class="p">,</span> <span class="n">th</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
                <span class="n">oh</span><span class="p">,</span> <span class="n">ow</span> <span class="o">=</span> <span class="n">tch</span><span class="p">,</span> <span class="n">tcw</span> <span class="o">=</span> <span class="n">texc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">tcx</span><span class="p">,</span> <span class="n">tcy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

                <span class="c"># adjust size/texcoord according to viewport</span>
                <span class="k">if</span> <span class="n">viewport_pos</span><span class="p">:</span>
                    <span class="n">tcx</span><span class="p">,</span> <span class="n">tcy</span> <span class="o">=</span> <span class="n">viewport_pos</span>
                    <span class="n">tcx</span> <span class="o">=</span> <span class="n">tcx</span> <span class="o">/</span> <span class="n">tw</span> <span class="o">*</span> <span class="p">(</span><span class="n">ow</span><span class="p">)</span>
                    <span class="n">tcy</span> <span class="o">=</span> <span class="n">tcy</span> <span class="o">/</span> <span class="n">th</span> <span class="o">*</span> <span class="n">oh</span>
                <span class="k">if</span> <span class="n">tw</span> <span class="o">-</span> <span class="n">viewport_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">vw</span><span class="p">:</span>
                    <span class="n">tcw</span> <span class="o">=</span> <span class="n">tcw</span> <span class="o">-</span> <span class="n">tcx</span>
                    <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tcw</span> <span class="o">*</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">vw</span> <span class="o">&lt;</span> <span class="n">tw</span><span class="p">:</span>
                    <span class="n">tcw</span> <span class="o">=</span> <span class="p">(</span><span class="n">vw</span> <span class="o">/</span> <span class="n">tw</span><span class="p">)</span> <span class="o">*</span> <span class="n">tcw</span>
                    <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">vw</span>
                <span class="k">if</span> <span class="n">vh</span> <span class="o">&lt;</span> <span class="n">th</span><span class="p">:</span>
                    <span class="n">tch</span> <span class="o">=</span> <span class="p">(</span><span class="n">vh</span> <span class="o">/</span> <span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">tch</span>
                    <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vh</span>

                <span class="c"># cropping</span>
                <span class="n">mlh</span> <span class="o">=</span> <span class="n">lh</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">maxy</span><span class="p">:</span>
                    <span class="n">vh</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">y</span> <span class="o">+</span> <span class="n">lh</span><span class="p">)</span>
                    <span class="n">tch</span> <span class="o">=</span> <span class="p">(</span><span class="n">vh</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">lh</span><span class="p">))</span> <span class="o">*</span> <span class="n">oh</span>
                    <span class="n">tcy</span> <span class="o">=</span> <span class="n">oh</span> <span class="o">-</span> <span class="n">tch</span>
                    <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vh</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">-</span> <span class="n">lh</span> <span class="o">&lt;</span> <span class="n">miny</span><span class="p">:</span>
                    <span class="n">diff</span> <span class="o">=</span> <span class="n">miny</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">lh</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">+=</span> <span class="n">diff</span>
                    <span class="n">vh</span> <span class="o">=</span> <span class="n">lh</span> <span class="o">-</span> <span class="n">diff</span>
                    <span class="n">tch</span> <span class="o">=</span> <span class="p">(</span><span class="n">vh</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">lh</span><span class="p">))</span> <span class="o">*</span> <span class="n">oh</span>
                    <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vh</span>

                <span class="n">texc</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">tcx</span><span class="p">,</span>
                    <span class="n">tcy</span> <span class="o">+</span> <span class="n">tch</span><span class="p">,</span>
                    <span class="n">tcx</span> <span class="o">+</span> <span class="n">tcw</span><span class="p">,</span>
                    <span class="n">tcy</span> <span class="o">+</span> <span class="n">tch</span><span class="p">,</span>
                    <span class="n">tcx</span> <span class="o">+</span> <span class="n">tcw</span><span class="p">,</span>
                    <span class="n">tcy</span><span class="p">,</span>
                    <span class="n">tcx</span><span class="p">,</span>
                    <span class="n">tcy</span><span class="p">)</span>

                <span class="c"># add rectangle.</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">rects</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span>
                <span class="n">r</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">mlh</span><span class="p">)</span>
                <span class="n">r</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
                <span class="n">r</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="n">texture</span>
                <span class="n">r</span><span class="o">.</span><span class="n">tex_coords</span> <span class="o">=</span> <span class="n">texc</span>
                <span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

            <span class="n">y</span> <span class="o">-=</span> <span class="n">dy</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_graphics_selection</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_graphics_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">remove_group</span><span class="p">(</span><span class="s">&#39;selection&#39;</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_spacing</span>
        <span class="n">rects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_rects</span>
        <span class="n">padding_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">padding_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">_top</span> <span class="o">-</span> <span class="n">padding_top</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">padding_bottom</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">_top</span> <span class="o">-</span> <span class="n">padding_top</span>
        <span class="n">draw_selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_selection</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
        <span class="n">get_cursor_from_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span>
        <span class="n">s1c</span><span class="p">,</span> <span class="n">s1r</span> <span class="o">=</span> <span class="n">get_cursor_from_index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">s2c</span><span class="p">,</span> <span class="n">s2r</span> <span class="o">=</span> <span class="n">get_cursor_from_index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">s2r</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c"># pass only the selection lines[]</span>
        <span class="c"># passing all the lines can get slow when dealing with a lot of text</span>
        <span class="n">y</span> <span class="o">-=</span> <span class="n">s1r</span> <span class="o">*</span> <span class="n">dy</span>
        <span class="n">_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="n">_get_text_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_width</span>
        <span class="n">tab_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_width</span>
        <span class="n">_label_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="n">padding_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">padding_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">canvas_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">add</span>
        <span class="n">selection_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_color</span>
        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_lines</span><span class="p">[</span><span class="n">s1r</span><span class="p">:</span><span class="n">s2r</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="n">s1r</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">miny</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">maxy</span> <span class="o">+</span> <span class="n">dy</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">rects</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span>
                <span class="n">draw_selection</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="p">(</span><span class="n">s1c</span><span class="p">,</span> <span class="n">s1r</span><span class="p">),</span>
                               <span class="p">(</span><span class="n">s2c</span><span class="p">,</span> <span class="n">s2r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">_lines</span><span class="p">,</span> <span class="n">_get_text_width</span><span class="p">,</span>
                               <span class="n">tab_width</span><span class="p">,</span> <span class="n">_label_cached</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span>
                               <span class="n">padding_left</span><span class="p">,</span> <span class="n">padding_right</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                               <span class="n">canvas_add</span><span class="p">,</span> <span class="n">selection_color</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">-=</span> <span class="n">dy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position_handles</span><span class="p">(</span><span class="s">&#39;both&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="p">(</span><span class="n">s1c</span><span class="p">,</span> <span class="n">s1r</span><span class="p">),</span> <span class="p">(</span><span class="n">s2c</span><span class="p">,</span> <span class="n">s2r</span><span class="p">),</span>\
            <span class="n">_lines</span><span class="p">,</span> <span class="n">_get_text_width</span><span class="p">,</span> <span class="n">tab_width</span><span class="p">,</span> <span class="n">_label_cached</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span>\
            <span class="n">padding_left</span><span class="p">,</span> <span class="n">padding_right</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">canvas_add</span><span class="p">,</span> <span class="n">selection_color</span> <span class="o">=</span> <span class="n">largs</span>
        <span class="c"># Draw the current selection on the widget.</span>
        <span class="k">if</span> <span class="n">line_num</span> <span class="o">&lt;</span> <span class="n">s1r</span> <span class="ow">or</span> <span class="n">line_num</span> <span class="o">&gt;</span> <span class="n">s2r</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span>
        <span class="k">if</span> <span class="n">line_num</span> <span class="o">==</span> <span class="n">s1r</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">_lines</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span>
            <span class="n">x1</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span>
            <span class="n">x1</span> <span class="o">+=</span> <span class="n">_get_text_width</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">s1c</span><span class="p">],</span> <span class="n">tab_width</span><span class="p">,</span> <span class="n">_label_cached</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line_num</span> <span class="o">==</span> <span class="n">s2r</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">_lines</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">_get_text_width</span><span class="p">(</span><span class="n">lines</span><span class="p">[:</span><span class="n">s2c</span><span class="p">],</span>
                                                       <span class="n">tab_width</span><span class="p">,</span>
                                                       <span class="n">_label_cached</span><span class="p">)</span>
        <span class="n">width_minus_padding</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="n">padding_right</span> <span class="o">+</span> <span class="n">padding_left</span><span class="p">)</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">width_minus_padding</span>
        <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">maxx</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">width_minus_padding</span><span class="p">)</span>
        <span class="n">canvas_add</span><span class="p">(</span><span class="n">Color</span><span class="p">(</span><span class="o">*</span><span class="n">selection_color</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s">&#39;selection&#39;</span><span class="p">))</span>
        <span class="n">canvas_add</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">(</span>
            <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">group</span><span class="o">=</span><span class="s">&#39;selection&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">on_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c"># if the size change, we might do invalid scrolling / text split</span>
        <span class="c"># size the text maybe be put after size_hint have been resolved.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_refresh_text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_hint_text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_get_cursor_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># return the current cursor x/y from the row/col</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_spacing</span>
        <span class="n">padding_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">padding_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">padding_left</span>
        <span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">-</span> <span class="n">padding_top</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">top</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span>
        <span class="n">y</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_row</span> <span class="o">*</span> <span class="n">dy</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_offset</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span><span class="p">,</span> <span class="n">y</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">left</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">left</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">top</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">top</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">_get_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get or create line options, to be used for Label creation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line_options</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_line_options</span> <span class="o">=</span> <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;font_size&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
                <span class="s">&#39;font_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_name</span><span class="p">,</span>
                <span class="s">&#39;anchor_x&#39;</span><span class="p">:</span> <span class="s">&#39;left&#39;</span><span class="p">,</span>
                <span class="s">&#39;anchor_y&#39;</span><span class="p">:</span> <span class="s">&#39;top&#39;</span><span class="p">,</span>
                <span class="s">&#39;padding_x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&#39;padding_y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&#39;padding&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line_options</span>

    <span class="k">def</span> <span class="nf">_create_line_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="c"># Create a label from a text, using line options</span>
        <span class="n">ntext</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">u&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">u&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">u&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hint</span><span class="p">:</span>  <span class="c"># Don&#39;t replace hint_text with *</span>
            <span class="n">ntext</span> <span class="o">=</span> <span class="s">u&#39;*&#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ntext</span><span class="p">)</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_line_options</span><span class="p">()</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\0</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ntext</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">kw</span><span class="p">))</span>
        <span class="n">texture</span> <span class="o">=</span> <span class="n">Cache_get</span><span class="p">(</span><span class="s">&#39;textinput.label&#39;</span><span class="p">,</span> <span class="n">cid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">texture</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># FIXME right now, we can&#39;t render very long line...</span>
            <span class="c"># if we move on &quot;VBO&quot; version as fallback, we won&#39;t need to</span>
            <span class="c"># do this.  try to found the maximum text we can handle</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">label_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ntext</span><span class="p">)</span>
            <span class="n">ld</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="c"># check for blank line</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ntext</span><span class="p">:</span>
                <span class="n">texture</span> <span class="o">=</span> <span class="n">Texture</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">Cache_append</span><span class="p">(</span><span class="s">&#39;textinput.label&#39;</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">texture</span>

            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">ntext</span><span class="p">[:</span><span class="n">label_len</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">ld</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">ld</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">ld</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ld</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="n">label_len</span> <span class="o">+=</span> <span class="n">ld</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c"># exception happen when we tried to render the text</span>
                    <span class="c"># reduce it...</span>
                    <span class="k">if</span> <span class="n">ld</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">ld</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ntext</span><span class="p">)</span>
                    <span class="n">ld</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ld</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ld</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">label_len</span><span class="p">:</span>
                        <span class="n">label_len</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">label_len</span> <span class="o">-=</span> <span class="n">ld</span>
                    <span class="k">continue</span>

            <span class="c"># ok, we found it.</span>
            <span class="n">texture</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">texture</span>
            <span class="n">Cache_append</span><span class="p">(</span><span class="s">&#39;textinput.label&#39;</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">texture</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">texture</span>

    <span class="k">def</span> <span class="nf">_tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="c"># Tokenize a text string from some delimiters</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">delimiters</span> <span class="o">=</span> <span class="s">u&#39; ,</span><span class="se">\&#39;</span><span class="s">&quot;.;:</span><span class="se">\n\r\t</span><span class="s">&#39;</span>
        <span class="n">oldindex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">delimiters</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">oldindex</span> <span class="o">!=</span> <span class="n">index</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">text</span><span class="p">[</span><span class="n">oldindex</span><span class="p">:</span><span class="n">index</span><span class="p">]</span>
            <span class="k">yield</span> <span class="n">text</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">oldindex</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">text</span><span class="p">[</span><span class="n">oldindex</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_split_smart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="c"># Do a &quot;smart&quot; split. If autowidth or autosize is set,</span>
        <span class="c"># we are not doing smart split, just a split on line break.</span>
        <span class="c"># Otherwise, we are trying to split as soon as possible, to prevent</span>
        <span class="c"># overflow on the widget.</span>

        <span class="c"># depend of the options, split the text on line, or word</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiline</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">lines_flags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">FL_IS_NEWLINE</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">lines</span><span class="p">,</span> <span class="n">lines_flags</span>

        <span class="c"># no autosize, do wordwrap.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_join</span> <span class="o">=</span> <span class="s">u&#39;&#39;</span><span class="o">.</span><span class="n">join</span>
        <span class="n">lines_append</span><span class="p">,</span> <span class="n">lines_flags_append</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">lines_flags</span><span class="o">.</span><span class="n">append</span>
        <span class="n">padding_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">padding_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">padding_left</span> <span class="o">-</span> <span class="n">padding_right</span>
        <span class="n">text_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_width</span>
        <span class="n">_tab_width</span><span class="p">,</span> <span class="n">_label_cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_cached</span>

        <span class="c"># try to add each word on current line.</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="n">is_newline</span> <span class="o">=</span> <span class="p">(</span><span class="n">word</span> <span class="o">==</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">text_width</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">_tab_width</span><span class="p">,</span> <span class="n">_label_cached</span><span class="p">)</span>
            <span class="c"># if we have more than the width, or if it&#39;s a newline,</span>
            <span class="c"># push the current line, and create a new one</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="n">width</span> <span class="ow">and</span> <span class="n">line</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_newline</span><span class="p">:</span>
                <span class="n">lines_append</span><span class="p">(</span><span class="n">_join</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                <span class="n">lines_flags_append</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">is_newline</span><span class="p">:</span>
                <span class="n">flags</span> <span class="o">|=</span> <span class="n">FL_IS_NEWLINE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">w</span>
                <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FL_IS_NEWLINE</span><span class="p">:</span>
            <span class="n">lines_append</span><span class="p">(</span><span class="n">_join</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
            <span class="n">lines_flags_append</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span><span class="p">,</span> <span class="n">lines_flags</span>

    <span class="k">def</span> <span class="nf">_key_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">displayed_str</span><span class="p">,</span> <span class="n">internal_str</span><span class="p">,</span> <span class="n">internal_action</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">if</span> <span class="n">internal_action</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">displayed_str</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">internal_action</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;shift&#39;</span><span class="p">,</span> <span class="s">&#39;shift_L&#39;</span><span class="p">,</span> <span class="s">&#39;shift_R&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selection_finished</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">internal_action</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;cursor_&#39;</span><span class="p">):</span>
            <span class="n">cc</span><span class="p">,</span> <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_cursor_movement</span><span class="p">(</span><span class="n">internal_action</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_finished</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cancel_selection</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="ow">and</span> <span class="n">internal_action</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;del&#39;</span><span class="p">,</span> <span class="s">&#39;backspace&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">internal_action</span> <span class="o">==</span> <span class="s">&#39;del&#39;</span><span class="p">:</span>
            <span class="c"># Move cursor one char to the right. If that was successful,</span>
            <span class="c"># do a backspace (effectively deleting char right of cursor)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_cursor_movement</span><span class="p">(</span><span class="s">&#39;cursor_right&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cursor</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">do_backspace</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;del&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">internal_action</span> <span class="o">==</span> <span class="s">&#39;backspace&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_backspace</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">internal_action</span> <span class="o">==</span> <span class="s">&#39;enter&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiline</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&#39;on_text_validate&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">internal_action</span> <span class="o">==</span> <span class="s">&#39;escape&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focus</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">internal_action</span> <span class="o">!=</span> <span class="s">&#39;escape&#39;</span><span class="p">:</span>
            <span class="c">#self._recalc_size()</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_key_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">displayed_str</span><span class="p">,</span> <span class="n">internal_str</span><span class="p">,</span> <span class="n">internal_action</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">if</span> <span class="n">internal_action</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;shift&#39;</span><span class="p">,</span> <span class="s">&#39;shift_L&#39;</span><span class="p">,</span> <span class="s">&#39;shift_R&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_selection</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">keyboard_on_key_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">):</span>
        <span class="c"># Keycodes on OSX:</span>
        <span class="n">ctrl</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1024</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">key_str</span> <span class="o">=</span> <span class="n">keycode</span>
        <span class="n">win</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win</span>

        <span class="c"># This allows *either* ctrl *or* cmd, but not both.</span>
        <span class="n">is_shortcut</span> <span class="o">=</span> <span class="p">(</span><span class="n">modifiers</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;ctrl&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">_is_osx</span> <span class="ow">and</span> <span class="n">modifiers</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;meta&#39;</span><span class="p">]))</span>
        <span class="n">is_interesting_key</span> <span class="o">=</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interesting_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="mi">27</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_tab</span> <span class="ow">and</span> <span class="nb">super</span><span class="p">(</span><span class="n">TextInput</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">keyboard_on_key_down</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_editable</span><span class="p">:</span>
            <span class="c"># duplicated but faster testing for non-editable keys</span>
            <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_interesting_key</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_shortcut</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">focused</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">text</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_interesting_key</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_hide_handles</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hide_cut_copy_paste</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span><span class="p">)</span>

            <span class="c"># check for command modes</span>
            <span class="c"># we use \x01INFO\x02 to get info from IME on mobiles</span>
            <span class="c"># pygame seems to pass \x01 as the unicode for ctrl+a</span>
            <span class="c"># checking for modifiers ensures conflict resolution.</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">modifiers</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_mode</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">modifiers</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_mode</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_mode</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">+=</span> <span class="n">text</span>
                <span class="k">return</span>

            <span class="n">_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span>
            <span class="k">if</span> <span class="n">_command</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">from_undo</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">_command</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">_command</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">_command</span> <span class="o">==</span> <span class="s">&#39;DEL&#39;</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">count</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">(</span><span class="n">from_undo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_index</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">count</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span> <span class="o">=</span> <span class="n">end</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">(</span><span class="n">from_undo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">_command</span> <span class="o">==</span> <span class="s">&#39;INSERT&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">_command</span> <span class="o">==</span> <span class="s">&#39;INSERTN&#39;</span><span class="p">:</span>
                    <span class="n">from_undo</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">_command</span> <span class="o">==</span> <span class="s">&#39;SELWORD&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="s">&#39;on_double_tap&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">_command</span> <span class="o">==</span> <span class="s">&#39;SEL&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                        <span class="n">Clock</span><span class="o">.</span><span class="n">schedule_once</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancel_selection</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">_command</span> <span class="o">==</span> <span class="s">&#39;CURCOL&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_row</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">is_shortcut</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">):</span>  <span class="c"># cut selection</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_cut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_text</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">):</span>  <span class="c"># copy selection</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">):</span>  <span class="c"># paste selection</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">paste</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">):</span>  <span class="c"># select all</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">select_all</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">):</span>  <span class="c"># undo</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_undo</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">):</span>  <span class="c"># redo</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">do_redo</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_selection</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="c">#self._recalc_size()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">is_interesting_key</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hide_cut_copy_paste</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hide_handles</span><span class="p">(</span><span class="n">win</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>  <span class="c"># escape</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">focused</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>  <span class="c"># tab</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert_text</span><span class="p">(</span><span class="s">u&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interesting_keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_key_down</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">keyboard_on_key_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">keycode</span><span class="p">):</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">key_str</span> <span class="o">=</span> <span class="n">keycode</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interesting_keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_key_up</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_hint_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_hint_text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_refresh_hint_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_lines</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_smart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hint_text</span><span class="p">)</span>
        <span class="n">_hint_text_labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_hint_text_rects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_create_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_line_label</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_lines</span><span class="p">:</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="n">_create_label</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">_hint_text_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
            <span class="n">_hint_text_rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rectangle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">lbl</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_lines</span> <span class="o">=</span> <span class="n">_lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_labels</span> <span class="o">=</span> <span class="n">_hint_text_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hint_text_rects</span> <span class="o">=</span> <span class="n">_hint_text_rects</span>

        <span class="c"># Remember to update graphics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_update_graphics</span><span class="p">()</span>

    <span class="c">#</span>
    <span class="c"># Properties</span>
    <span class="c">#</span>

    <span class="n">_lines</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([])</span>
    <span class="n">_hint_text_lines</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([])</span>
    <span class="n">_editable</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_insert_int_patu</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">u&#39;[^0-9]&#39;</span><span class="p">)</span>
    <span class="n">_insert_int_patb</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;[^0-9]&#39;</span><span class="p">)</span>

    <span class="n">readonly</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;If True, the user will not be able to change the content of a textinput.</span>

<span class="sd">    .. versionadded:: 1.3.0</span>

<span class="sd">    :attr:`readonly` is a :class:`~kivy.properties.BooleanProperty` and</span>
<span class="sd">    defaults to False.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">multiline</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;If True, the widget will be able show multiple lines of text. If False,</span>
<span class="sd">    the &quot;enter&quot; keypress will defocus the textinput instead of adding a new</span>
<span class="sd">    line.</span>

<span class="sd">    :attr:`multiline` is a :class:`~kivy.properties.BooleanProperty` and</span>
<span class="sd">    defaults to True.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">password</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;If True, the widget will display its characters as the character &#39;*&#39;.</span>

<span class="sd">    .. versionadded:: 1.2.0</span>

<span class="sd">    :attr:`password` is a :class:`~kivy.properties.BooleanProperty` and</span>
<span class="sd">    defaults to False.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">keyboard_suggestions</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;If True provides auto suggestions on top of keyboard.</span>
<span class="sd">    This will only work if :attr:`input_type` is set to `text`.</span>

<span class="sd">     .. versionadded:: 1.8.0</span>

<span class="sd">     :attr:`keyboard_suggestions` is a</span>
<span class="sd">     :class:`~kivy.properties.BooleanProperty` defaults to True.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">cursor_blink</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;This property is used to blink the cursor graphic. The value of</span>
<span class="sd">    :attr:`cursor_blink` is automatically computed. Setting a value on it will</span>
<span class="sd">    have no impact.</span>

<span class="sd">    :attr:`cursor_blink` is a :class:`~kivy.properties.BooleanProperty` and</span>
<span class="sd">    defaults to False.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_get_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span>

    <span class="k">def</span> <span class="nf">_set_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_refresh_text</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">cr</span><span class="p">]))</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">cc</span><span class="p">,</span> <span class="n">cr</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span> <span class="o">=</span> <span class="n">cursor</span>

        <span class="c"># adjust scrollview to ensure that the cursor will be always inside our</span>
        <span class="c"># viewport.</span>
        <span class="n">padding_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">padding_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">viewport_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">padding_left</span> <span class="o">-</span> <span class="n">padding_right</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor_offset</span><span class="p">()</span>

        <span class="c"># if offset is outside the current bounds, reajust</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="n">viewport_width</span> <span class="o">+</span> <span class="n">sx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">-</span> <span class="n">viewport_width</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">sx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_x</span> <span class="o">=</span> <span class="n">offset</span>

        <span class="c"># do the same for Y</span>
        <span class="c"># this algo try to center the cursor as much as possible</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_spacing</span>
        <span class="n">offsety</span> <span class="o">=</span> <span class="n">cr</span> <span class="o">*</span> <span class="n">dy</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span>
        <span class="n">padding_top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">padding_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">viewport_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">padding_top</span> <span class="o">-</span> <span class="n">padding_bottom</span> <span class="o">-</span> <span class="n">dy</span>
        <span class="k">if</span> <span class="n">offsety</span> <span class="o">&gt;</span> <span class="n">viewport_height</span> <span class="o">+</span> <span class="n">sy</span><span class="p">:</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">offsety</span> <span class="o">-</span> <span class="n">viewport_height</span>
        <span class="k">if</span> <span class="n">offsety</span> <span class="o">&lt;</span> <span class="n">sy</span><span class="p">:</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">offsety</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_y</span> <span class="o">=</span> <span class="n">sy</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="n">cursor</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">_get_cursor</span><span class="p">,</span> <span class="n">_set_cursor</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Tuple of (row, col) values indicating the current cursor position.</span>
<span class="sd">    You can set a new (row, col) if you want to move the cursor. The scrolling</span>
<span class="sd">    area will be automatically updated to ensure that the cursor is</span>
<span class="sd">    visible inside the viewport.</span>

<span class="sd">    :attr:`cursor` is an :class:`~kivy.properties.AliasProperty`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_get_cursor_col</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">cursor_col</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">_get_cursor_col</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;cursor&#39;</span><span class="p">,</span> <span class="p">))</span>
    <span class="sd">&#39;&#39;&#39;Current column of the cursor.</span>

<span class="sd">    :attr:`cursor_col` is an :class:`~kivy.properties.AliasProperty` to</span>
<span class="sd">    cursor[0], read-only.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_get_cursor_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cursor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">cursor_row</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">_get_cursor_row</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;cursor&#39;</span><span class="p">,</span> <span class="p">))</span>
    <span class="sd">&#39;&#39;&#39;Current row of the cursor.</span>

<span class="sd">    :attr:`cursor_row` is an :class:`~kivy.properties.AliasProperty` to</span>
<span class="sd">    cursor[1], read-only.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">cursor_pos</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">_get_cursor_pos</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="p">(</span>
        <span class="s">&#39;cursor&#39;</span><span class="p">,</span> <span class="s">&#39;padding&#39;</span><span class="p">,</span> <span class="s">&#39;pos&#39;</span><span class="p">,</span> <span class="s">&#39;size&#39;</span><span class="p">,</span> <span class="s">&#39;focus&#39;</span><span class="p">,</span>
        <span class="s">&#39;scroll_x&#39;</span><span class="p">,</span> <span class="s">&#39;scroll_y&#39;</span><span class="p">))</span>
    <span class="sd">&#39;&#39;&#39;Current position of the cursor, in (x, y).</span>

<span class="sd">    :attr:`cursor_pos` is an :class:`~kivy.properties.AliasProperty`,</span>
<span class="sd">    read-only.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">cursor_color</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;Current color of the cursor, in (r, g, b, a) format.</span>

<span class="sd">    .. versionadded:: 1.9.0</span>

<span class="sd">    :attr:`cursor_color` is a :class:`~kivy.properties.ListProperty` and</span>
<span class="sd">    defaults to [1, 0, 0, 1].</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">line_height</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Height of a line. This property is automatically computed from the</span>
<span class="sd">    :attr:`font_name`, :attr:`font_size`. Changing the line_height will have</span>
<span class="sd">    no impact.</span>

<span class="sd">    .. note::</span>

<span class="sd">        :attr:`line_height` is the height of a single line of text.</span>
<span class="sd">        Use :attr:`minimum_height`, which also includes padding, to</span>
<span class="sd">        get the height required to display the text properly.</span>

<span class="sd">    :attr:`line_height` is a :class:`~kivy.properties.NumericProperty`,</span>
<span class="sd">    read-only.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">tab_width</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;By default, each tab will be replaced by four spaces on the text</span>
<span class="sd">    input widget. You can set a lower or higher value.</span>

<span class="sd">    :attr:`tab_width` is a :class:`~kivy.properties.NumericProperty` and</span>
<span class="sd">    defaults to 4.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">padding_x</span> <span class="o">=</span> <span class="n">VariableListProperty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Horizontal padding of the text: [padding_left, padding_right].</span>

<span class="sd">    padding_x also accepts a one argument form [padding_horizontal].</span>

<span class="sd">    :attr:`padding_x` is a :class:`~kivy.properties.VariableListProperty` and</span>
<span class="sd">    defaults to [0, 0]. This might be changed by the current theme.</span>

<span class="sd">    .. deprecated:: 1.7.0</span>
<span class="sd">        Use :attr:`padding` instead.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">on_padding_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">padding_y</span> <span class="o">=</span> <span class="n">VariableListProperty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Vertical padding of the text: [padding_top, padding_bottom].</span>

<span class="sd">    padding_y also accepts a one argument form [padding_vertical].</span>

<span class="sd">    :attr:`padding_y` is a :class:`~kivy.properties.VariableListProperty` and</span>
<span class="sd">    defaults to [0, 0]. This might be changed by the current theme.</span>

<span class="sd">    .. deprecated:: 1.7.0</span>
<span class="sd">        Use :attr:`padding` instead.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">on_padding_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">padding</span> <span class="o">=</span> <span class="n">VariableListProperty</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;Padding of the text: [padding_left, padding_top, padding_right,</span>
<span class="sd">    padding_bottom].</span>

<span class="sd">    padding also accepts a two argument form [padding_horizontal,</span>
<span class="sd">    padding_vertical] and a one argument form [padding].</span>

<span class="sd">    .. versionchanged:: 1.7.0</span>
<span class="sd">        Replaced AliasProperty with VariableListProperty.</span>

<span class="sd">    :attr:`padding` is a :class:`~kivy.properties.VariableListProperty` and</span>
<span class="sd">    defaults to [6, 6, 6, 6].</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">scroll_x</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;X scrolling value of the viewport. The scrolling is automatically</span>
<span class="sd">    updated when the cursor is moved or text changed. If there is no</span>
<span class="sd">    user input, the scroll_x and scroll_y properties may be changed.</span>

<span class="sd">    :attr:`scroll_x` is a :class:`~kivy.properties.NumericProperty` and</span>
<span class="sd">    defaults to 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">scroll_y</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Y scrolling value of the viewport. See :attr:`scroll_x` for more</span>
<span class="sd">    information.</span>

<span class="sd">    :attr:`scroll_y` is a :class:`~kivy.properties.NumericProperty` and</span>
<span class="sd">    defaults to 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">selection_color</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="mf">0.1843</span><span class="p">,</span> <span class="mf">0.6549</span><span class="p">,</span> <span class="mf">0.8313</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;Current color of the selection, in (r, g, b, a) format.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        The color should always have an &quot;alpha&quot; component less than 1</span>
<span class="sd">        since the selection is drawn after the text.</span>

<span class="sd">    :attr:`selection_color` is a :class:`~kivy.properties.ListProperty` and</span>
<span class="sd">    defaults to [0.1843, 0.6549, 0.8313, .5].</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">border</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;Border used for :class:`~kivy.graphics.vertex_instructions.BorderImage`</span>
<span class="sd">    graphics instruction. Used with :attr:`background_normal` and</span>
<span class="sd">    :attr:`background_active`. Can be used for a custom background.</span>

<span class="sd">    .. versionadded:: 1.4.1</span>

<span class="sd">    It must be a list of four values: (top, right, bottom, left). Read the</span>
<span class="sd">    BorderImage instruction for more information about how to use it.</span>

<span class="sd">    :attr:`border` is a :class:`~kivy.properties.ListProperty` and defaults</span>
<span class="sd">    to (4, 4, 4, 4).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">background_normal</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span>
        <span class="s">&#39;atlas://data/images/defaulttheme/textinput&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Background image of the TextInput when it&#39;s not in focus.</span>

<span class="sd">    .. versionadded:: 1.4.1</span>

<span class="sd">    :attr:`background_normal` is a :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to &#39;atlas://data/images/defaulttheme/textinput&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">background_disabled_normal</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span>
        <span class="s">&#39;atlas://data/images/defaulttheme/textinput_disabled&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Background image of the TextInput when disabled.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`background_disabled_normal` is a</span>
<span class="sd">    :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to &#39;atlas://data/images/defaulttheme/textinput_disabled&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">background_active</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span>
        <span class="s">&#39;atlas://data/images/defaulttheme/textinput_active&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Background image of the TextInput when it&#39;s in focus.</span>

<span class="sd">    .. versionadded:: 1.4.1</span>

<span class="sd">    :attr:`background_active` is a</span>
<span class="sd">    :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to &#39;atlas://data/images/defaulttheme/textinput_active&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">background_disabled_active</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span>
        <span class="s">&#39;atlas://data/images/defaulttheme/textinput_disabled_active&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Background image of the TextInput when it&#39;s in focus and disabled.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`background_disabled_active` is a</span>
<span class="sd">    :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to &#39;atlas://data/images/defaulttheme/textinput_disabled_active&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">background_color</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;Current color of the background, in (r, g, b, a) format.</span>

<span class="sd">    .. versionadded:: 1.2.0</span>

<span class="sd">    :attr:`background_color` is a :class:`~kivy.properties.ListProperty`</span>
<span class="sd">    and defaults to [1, 1, 1, 1] (white).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">foreground_color</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;Current color of the foreground, in (r, g, b, a) format.</span>

<span class="sd">    .. versionadded:: 1.2.0</span>

<span class="sd">    :attr:`foreground_color` is a :class:`~kivy.properties.ListProperty`</span>
<span class="sd">    and defaults to [0, 0, 0, 1] (black).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">disabled_foreground_color</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;Current color of the foreground when disabled, in (r, g, b, a) format.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`disabled_foreground_color` is a</span>
<span class="sd">    :class:`~kivy.properties.ListProperty` and</span>
<span class="sd">    defaults to [0, 0, 0, 5] (50% transparent black).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">use_bubble</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="ow">not</span> <span class="n">_is_desktop</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Indicates whether the cut/copy/paste bubble is used.</span>

<span class="sd">    .. versionadded:: 1.7.0</span>

<span class="sd">    :attr:`use_bubble` is a :class:`~kivy.properties.BooleanProperty`</span>
<span class="sd">    and defaults to True on mobile OS&#39;s, False on desktop OS&#39;s.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">use_handles</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="ow">not</span> <span class="n">_is_desktop</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Indicates whether the selection handles are displayed.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`use_handles` is a :class:`~kivy.properties.BooleanProperty`</span>
<span class="sd">    and defaults to True on mobile OS&#39;s, False on desktop OS&#39;s.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_sel_from</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_from</span>

    <span class="n">selection_from</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">get_sel_from</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;If a selection is in progress or complete, this property will represent</span>
<span class="sd">    the cursor index where the selection started.</span>

<span class="sd">    .. versionchanged:: 1.4.0</span>
<span class="sd">        :attr:`selection_from` is an :class:`~kivy.properties.AliasProperty` and</span>
<span class="sd">        defaults to None, readonly.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_sel_to</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selection_to</span>

    <span class="n">selection_to</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">get_sel_to</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;If a selection is in progress or complete, this property will represent</span>
<span class="sd">    the cursor index where the selection started.</span>

<span class="sd">    .. versionchanged:: 1.4.0</span>
<span class="sd">        :attr:`selection_to` is an :class:`~kivy.properties.AliasProperty` and</span>
<span class="sd">        defaults to None, readonly.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">selection_text</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s">u&#39;&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Current content selection.</span>

<span class="sd">    :attr:`selection_text` is a :class:`~kivy.properties.StringProperty`</span>
<span class="sd">    and defaults to &#39;&#39;, readonly.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">on_selection_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_handles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_show_handles</span><span class="p">()</span>

    <span class="n">focus</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;If focus is True, the keyboard will be requested and you can start</span>
<span class="sd">    entering text into the textinput.</span>

<span class="sd">    :attr:`focus` is a :class:`~kivy.properties.BooleanProperty` and defaults</span>
<span class="sd">    to False.</span>

<span class="sd">    .. Note::</span>
<span class="sd">            Selection is cancelled when TextInput is focused. If you need to</span>
<span class="sd">            show selection when TextInput is focused, you should delay</span>
<span class="sd">            (use Clock.schedule) the call to the functions for selecting</span>
<span class="sd">            text (select_all, select_text).</span>

<span class="sd">    ..versionchanged:: 1.9.0</span>
<span class="sd">        :class:`TextInput` now inherits from</span>
<span class="sd">        :class:`~kivy.uix.behaviors.FocusBehavior` and :attr:`focus` is now</span>
<span class="sd">        an alias for :attr:`focused`. Setting either one will also set the</span>
<span class="sd">        other.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_get_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">lf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines_flags</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lines</span>
        <span class="n">len_l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">len_l</span><span class="p">:</span>
            <span class="n">lf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s">u&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="s">u&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">lf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FL_IS_NEWLINE</span><span class="p">)</span> <span class="k">else</span> <span class="s">u&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_l</span><span class="p">)])</span>

        <span class="k">if</span> <span class="n">PY2</span> <span class="ow">and</span> <span class="n">encode</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">_set_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">PY2</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text</span><span class="p">(</span><span class="n">encode</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">==</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_from_index</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">_get_text</span><span class="p">,</span> <span class="n">_set_text</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;_lines&#39;</span><span class="p">,</span> <span class="p">))</span>
    <span class="sd">&#39;&#39;&#39;Text of the widget.</span>

<span class="sd">    Creation of a simple hello world::</span>

<span class="sd">        widget = TextInput(text=&#39;Hello world&#39;)</span>

<span class="sd">    If you want to create the widget with an unicode string, use::</span>

<span class="sd">        widget = TextInput(text=u&#39;My unicode string&#39;)</span>

<span class="sd">    :attr:`text` a :class:`~kivy.properties.StringProperty`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">font_name</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s">&#39;DroidSans&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Filename of the font to use. The path can be absolute or relative.</span>
<span class="sd">    Relative paths are resolved by the :func:`~kivy.resources.resource_find`</span>
<span class="sd">    function.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        Depending on your text provider, the font file may be ignored. However,</span>
<span class="sd">        you can mostly use this without problems.</span>

<span class="sd">        If the font used lacks the glyphs for the particular language/symbols</span>
<span class="sd">        you are using, you will see &#39;[]&#39; blank box characters instead of the</span>
<span class="sd">        actual glyphs. The solution is to use a font that has the glyphs you</span>
<span class="sd">        need to display. For example, to display |unicodechar|, use a font like</span>
<span class="sd">        freesans.ttf that has the glyph.</span>

<span class="sd">        .. |unicodechar| image:: images/unicode-char.png</span>

<span class="sd">    :attr:`font_name` is a :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to &#39;DroidSans&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">font_size</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="s">&#39;15sp&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Font size of the text in pixels.</span>

<span class="sd">    :attr:`font_size` is a :class:`~kivy.properties.NumericProperty` and</span>
<span class="sd">    defaults to 10.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">hint_text</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Hint text of the widget.</span>

<span class="sd">    Shown if text is &#39;&#39; and focus is False.</span>

<span class="sd">    .. versionadded:: 1.6.0</span>

<span class="sd">    :attr:`hint_text` a :class:`~kivy.properties.StringProperty` and defaults</span>
<span class="sd">    to &#39;&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">hint_text_color</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;Current color of the hint_text text, in (r, g, b, a) format.</span>

<span class="sd">    .. versionadded:: 1.6.0</span>

<span class="sd">    :attr:`hint_text_color` is a :class:`~kivy.properties.ListProperty` and</span>
<span class="sd">    defaults to [0.5, 0.5, 0.5, 1.0] (grey).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">auto_indent</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Automatically indent multiline text.</span>

<span class="sd">    .. versionadded:: 1.7.0</span>

<span class="sd">    :attr:`auto_indent` is a :class:`~kivy.properties.BooleanProperty` and</span>
<span class="sd">    defaults to False.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">allow_copy</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Decides whether to allow copying the text.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`allow_copy` is a :class:`~kivy.properties.BooleanProperty` and</span>
<span class="sd">    defaults to True.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_get_min_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lines</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_spacing</span><span class="p">)</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">minimum_height</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">_get_min_height</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                                   <span class="n">bind</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;_lines&#39;</span><span class="p">,</span> <span class="s">&#39;line_spacing&#39;</span><span class="p">,</span> <span class="s">&#39;padding&#39;</span><span class="p">,</span>
                                         <span class="s">&#39;font_size&#39;</span><span class="p">,</span> <span class="s">&#39;font_name&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span>
                                         <span class="s">&#39;hint_text&#39;</span><span class="p">,</span> <span class="s">&#39;line_height&#39;</span><span class="p">))</span>
    <span class="sd">&#39;&#39;&#39;Minimum height of the content inside the TextInput.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`minimum_height` is a readonly</span>
<span class="sd">    :class:`~kivy.properties.AliasProperty`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">line_spacing</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Space taken up between the lines.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`line_spacing` is a :class:`~kivy.properties.NumericProperty` and</span>
<span class="sd">    defaults to 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">input_filter</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">allownone</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39; Filters the input according to the specified mode, if not None. If</span>
<span class="sd">    None, no filtering is applied.</span>

<span class="sd">    .. versionadded:: 1.9.0</span>

<span class="sd">    :attr:`input_filter` is an :class:`~kivy.properties.ObjectProperty` and</span>
<span class="sd">    defaults to `None`. Can be one of `None`, `&#39;int&#39;` (string), or `&#39;float&#39;`</span>
<span class="sd">    (string), or a callable. If it is `&#39;int&#39;`, it will only accept numbers.</span>
<span class="sd">    If it is `&#39;float&#39;` it will also accept a single period. Finally, if it is</span>
<span class="sd">    a callable it will be called with two parameter; the string to be added</span>
<span class="sd">    and a bool indicating whether the string is a result of undo (True). The</span>
<span class="sd">    callable should return a new substring that will be used instead.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">handle_image_middle</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span>
        <span class="s">&#39;atlas://data/images/defaulttheme/selector_middle&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Image used to display the middle handle on the TextInput for cursor</span>
<span class="sd">    positioning.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`handle_image_middle` is a :class:`~kivy.properties.StringProperty`</span>
<span class="sd">    and defaults to &#39;atlas://data/images/defaulttheme/selector_middle&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">on_handle_image_middle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_middle</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">handle_image_left</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span>
        <span class="s">&#39;atlas://data/images/defaulttheme/selector_left&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Image used to display the Left handle on the TextInput for selection.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`handle_image_left` is a :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to &#39;atlas://data/images/defaulttheme/selector_left&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">on_handle_image_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_left</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">handle_image_right</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span>
        <span class="s">&#39;atlas://data/images/defaulttheme/selector_right&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Image used to display the Right handle on the TextInput for selection.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`handle_image_right` is a</span>
<span class="sd">    :class:`~kivy.properties.StringProperty` and defaults to</span>
<span class="sd">    &#39;atlas://data/images/defaulttheme/selector_right&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">on_handle_image_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_right</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">write_tab</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Whether the tab key should move focus to the next widget or if it should</span>
<span class="sd">    enter a tab in the :class:`TextInput`. If `True` a tab will be written,</span>
<span class="sd">    otherwise, focus will move to the next widget.</span>

<span class="sd">    .. versionadded:: 1.9.0</span>

<span class="sd">    :attr:`write_tab` is a :class:`~kivy.properties.BooleanProperty` and</span>
<span class="sd">    defaults to `True`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">kivy.app</span> <span class="kn">import</span> <span class="n">App</span>
    <span class="kn">from</span> <span class="nn">kivy.uix.boxlayout</span> <span class="kn">import</span> <span class="n">BoxLayout</span>

    <span class="k">class</span> <span class="nc">TextInputApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">BoxLayout</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
            <span class="n">textinput</span> <span class="o">=</span> <span class="n">TextInput</span><span class="p">(</span><span class="n">multiline</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">use_bubble</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                  <span class="n">use_handles</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">textinput</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">__doc__</span>
            <span class="n">root</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">textinput</span><span class="p">)</span>
            <span class="n">textinput2</span> <span class="o">=</span> <span class="n">TextInput</span><span class="p">(</span><span class="n">multiline</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&#39;monoline textinput&#39;</span><span class="p">,</span>
                                   <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">root</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">textinput2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">root</span>

    <span class="n">TextInputApp</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

            <div class="footerlinks">
              </div>
          </div>
        </div>
      </div>
      </div>
      <div class="clearer"></div>
    </div>
    </div>
<!-- Piwik --> 
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://txzone.net/piwik/" : "http://txzone.net/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 8);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://txzone.net/piwik/piwik.php?idsite=8" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->
    <!--
    <div class="footer">
      &copy; Copyright 2010, The Kivy Authors.
      Last updated on Dec 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b1.
</div>
-->
  </body>

<!-- Mirrored from kivy.org/docs/_modules/kivy/uix/textinput.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jan 2015 07:56:38 GMT -->
</html>