<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from kivy.org/docs/_modules/kivy/uix/rst.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jan 2015 07:56:38 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="twitter:site" content="@kivyframework">
    
    <title>kivy.uix.rst &mdash; Kivy 1.9.0-dev documentation</title>
    <link href='../../../../../fonts.googleapis.com/css8da2.css?family=Source+Code+Pro:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../../../_static/fresh.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.9.0-dev',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../cdn.mathjax.org/mathjax/latest/MathJaxdda6.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/jquery-effects-core-and-slide.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../../_static/kivy.js"></script>
    <link rel="top" title="Kivy 1.9.0-dev documentation" href="../../../index-2.html" />
    <link rel="up" title="kivy" href="../../kivy.html" /> 
  </head>
  <body>

    <div id="topbar">
        <div id="topwrapper">
        <div id="toplogo">
            <a href="http://kivy.org/">
                <img src="../../../_static/logo-kivy.png" alt="Kivy" height="50"/>
            </a>
        </div>
        <div id="topmenu">
            <ul class="navigation">
                <li><a class="nav-guides" href="../../../gettingstarted/intro.html">Guides</a></li>
                <li><a class="nav-garden" href="http://kivy-garden.github.io/">Garden</a></li>
                <li><a class="nav-api" href="../../../api-kivy.html">API Reference</a></li>
                <li><a class="nav-pdf" href="../../../pdf/Kivy-latest.pdf">PDF</a></li>
                <li><a class="nav-wiki" href="http://wiki.kivy.org/">Wiki</a></li>
            </ul>
        </div>
        </div>
    </div>
<div id="contentall">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3>Quick search</h3>
            <form class="search" action="http://kivy.org/docs/search.html" method="get">
                &nbsp;
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
                <input type="text" class="text" name="q" />
            </form>
          <!--
          <h3><a href="../../../index.html">kivy.uix.rst</a></h3>
          
          <h3><a href="../../../index.html">Table Of Contents</a></h3>
          -->
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/first_app.html">A first App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/properties.html">Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/rules.html">Kv Design Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/events.html">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/framework.html">Non-widget stuff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/layouts.html">Layouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/drawing.html">Drawing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/packaging.html">Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gettingstarted/diving.html">Diving in</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-guide.html">User&#8217;s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../philosophy.html">Philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contribute.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faq.html">FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contact.html">Contact Us</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide-index.html">Programming Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/basic.html">Kivy Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/environment.html">Controlling the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/config.html">Configure Kivy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/architecture.html">Architectural Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/events.html">Events and Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/inputs.html">Input management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/widgets.html">Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/graphics.html">Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/lang.html">Kv language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/other-frameworks.html">Integrating with other Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/bestpractices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/advancedgraphics.html">Advanced Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../guide/packaging.html">Packaging your application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials-index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/pong.html">Pong Game Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/firstwidget.html">A Simple Paint App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.html">Kivy framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.html">Adapters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.adapter.html">Adapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.args_converters.html">List Item View Argument Converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.dictadapter.html">DictAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.listadapter.html">ListAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.models.html">SelectableDataItem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.adapters.simplelistadapter.html">SimpleListAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.animation.html">Animation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.app.html">Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.atlas.html">Atlas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.base.html">Kivy Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.cache.html">Cache manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.clock.html">Clock object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.compat.html">Compatibility module for Python 2.7 and &gt; 3.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.config.html">Configuration object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.context.html">Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.html">Core Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.audio.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.camera.html">Camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.clipboard.html">Clipboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.gl.html">OpenGL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.image.html">Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.spelling.html">Spelling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.text.html">Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.text.markup.html">Text Markup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.text.text_layout.html">Text layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.video.html">Video</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.core.window.html">Window</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.html">Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.dampedscroll.html">Damped scroll effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.kinetic.html">Kinetic effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.opacityscroll.html">Opacity scroll effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.effects.scroll.html">Scroll effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.event.html">Event dispatcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.ext.html">Extension Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.factory.html">Factory object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.garden.html">Garden</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.geometry.html">Geometry utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.gesture.html">Gesture recognition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.html">Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.compiler.html">Graphics compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.context.html">Context management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.context_instructions.html">Context instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.fbo.html">Framebuffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.gl_instructions.html">GL instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.instructions.html">Canvas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.opengl.html">OpenGL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.opengl_utils.html">OpenGL utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.shader.html">Shader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.stencil_instructions.html">Stencil instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.svg.html">SVG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.tesselator.html">Tesselator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.texture.html">Texture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.graphics.transformation.html">Transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.html">Input management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.factory.html">Motion Event Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.motionevent.html">Motion Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.html">Input Postprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.calibration.html">Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.dejitter.html">Dejitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.doubletap.html">Double Tap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.ignorelist.html">Ignore list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.retaintouch.html">Retain Touch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.postproc.tripletap.html">Triple Tap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.provider.html">Motion Event Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.html">Providers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.androidjoystick.html">Android Joystick Input Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.hidinput.html">Native support for HID input from the linux kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.leapfinger.html">Leap Motion - finger only</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.linuxwacom.html">Native support of Wacom tablet from linuxwacom driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.mactouch.html">Native support of MultitouchSupport framework for MacBook (MaxOSX platform)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.mouse.html">Mouse provider implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.mtdev.html">Native support for Multitouch devices on Linux, using libmtdev.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.probesysfs.html">Auto Create Input Provider Config Entry for Available MT Hardware (linux only).</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.tuio.html">TUIO Input Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.wm_common.html">Common definitions for a Windows provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.wm_pen.html">Support for WM_PEN messages (Windows platform)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.providers.wm_touch.html">Support for WM_TOUCH messages (Windows platform)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.recorder.html">Input recorder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.input.shape.html">Motion Event Shape</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.interactive.html">Interactive launcher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.lang.html">Kivy Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.lib.html">External libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.lib.gstplayer.html">GstPlayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.loader.html">Asynchronous data loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.logger.html">Logger object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.inspector.html">Inspector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.keybinding.html">Keybinding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.monitor.html">Monitor module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.recorder.html">Recorder module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.screen.html">Screen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.touchring.html">Touchring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.modules.webdebugger.html">Web Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.multistroke.html">Multistroke gesture recognizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.network.html">Network support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.network.urlrequest.html">Url Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.parser.html">Parser utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.properties.html">Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.resources.html">Resources management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.storage.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.storage.dictstore.html">Dictionary store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.storage.jsonstore.html">JSON store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.storage.redisstore.html">Redis Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.support.html">Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.html">Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.abstractview.html">Abstract View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.accordion.html">Accordion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.actionbar.html">Action Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.anchorlayout.html">Anchor Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.behaviors.html">Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.boxlayout.html">Box Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.bubble.html">Bubble</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.button.html">Button</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.camera.html">Camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.carousel.html">Carousel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.checkbox.html">CheckBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.codeinput.html">Code Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.colorpicker.html">Color Picker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.dropdown.html">Drop-Down List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.effectwidget.html">EffectWidget</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.filechooser.html">FileChooser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.floatlayout.html">Float Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.gesturesurface.html">Gesture Surface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.gridlayout.html">Grid Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.image.html">Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.label.html">Label</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.layout.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.listview.html">List View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.modalview.html">ModalView</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.pagelayout.html">PageLayout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.popup.html">Popup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.progressbar.html">Progress Bar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.relativelayout.html">Relative Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.rst.html">reStructuredText renderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.sandbox.html">Sandbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.scatter.html">Scatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.scatterlayout.html">Scatter Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.screenmanager.html">Screen Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.scrollview.html">Scroll View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.settings.html">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.slider.html">Slider</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.spinner.html">Spinner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.splitter.html">Splitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.stacklayout.html">Stack Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.stencilview.html">Stencil View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.switch.html">Switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.tabbedpanel.html">TabbedPanel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.textinput.html">Text Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.togglebutton.html">Toggle button</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.treeview.html">Tree View</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.video.html">Video</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.videoplayer.html">Video player</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.vkeyboard.html">VKeyboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.uix.widget.html">Widget class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.utils.html">Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.vector.html">Vector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api-kivy.weakmethod.html">Weak Method</a></li>
</ul>
</li>
</ul>

          <!--
          <h3>Related Topics</h3>
          <ul>
          </ul>
          -->
        </div>
      </div>
    <div id="content">
    <div class="wrapper">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div class="toc"><h2>Table Of Contents</h2></div>
            
  <h1>Source code for kivy.uix.rst</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">reStructuredText renderer</span>
<span class="sd">=========================</span>

<span class="sd">.. versionadded:: 1.1.0</span>

<span class="sd">`reStructuredText &lt;http://docutils.sourceforge.net/rst.html&gt;`_ is an</span>
<span class="sd">easy-to-read, what-you-see-is-what-you-get plaintext markup syntax and parser</span>
<span class="sd">system.</span>

<span class="sd">.. warning::</span>

<span class="sd">    This widget is highly experimental. The whole styling and</span>
<span class="sd">    implementation are not stable until this warning has been removed.</span>

<span class="sd">Usage with Text</span>
<span class="sd">---------------</span>

<span class="sd">::</span>

<span class="sd">    text = &quot;&quot;&quot;</span>
<span class="sd">    .. _top:</span>

<span class="sd">    Hello world</span>
<span class="sd">    ===========</span>

<span class="sd">    This is an **emphased text**, some ``interpreted text``.</span>
<span class="sd">    And this is a reference to top_::</span>

<span class="sd">        $ print(&quot;Hello world&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    document = RstDocument(text=text)</span>

<span class="sd">The rendering will output:</span>

<span class="sd">.. image:: images/rstdocument.png</span>

<span class="sd">Usage with Source</span>
<span class="sd">-----------------</span>

<span class="sd">You can also render a rst file using the :attr:`RstDocument.source` property::</span>

<span class="sd">    document = RstDocument(source=&#39;index.rst&#39;)</span>

<span class="sd">You can reference other documents with the role ``:doc:``. For example, in the</span>
<span class="sd">document ``index.rst`` you can write::</span>

<span class="sd">    Go to my next document: :doc:`moreinfo.rst`</span>

<span class="sd">It will generate a link that, when clicked, opens the ``moreinfo.rst``</span>
<span class="sd">document.</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;RstDocument&#39;</span><span class="p">,</span> <span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">exists</span><span class="p">,</span> <span class="n">abspath</span>
<span class="kn">from</span> <span class="nn">kivy.clock</span> <span class="kn">import</span> <span class="n">Clock</span>
<span class="kn">from</span> <span class="nn">kivy.compat</span> <span class="kn">import</span> <span class="n">PY2</span>
<span class="kn">from</span> <span class="nn">kivy.properties</span> <span class="kn">import</span> <span class="n">ObjectProperty</span><span class="p">,</span> <span class="n">NumericProperty</span><span class="p">,</span> \
    <span class="n">DictProperty</span><span class="p">,</span> <span class="n">ListProperty</span><span class="p">,</span> <span class="n">StringProperty</span><span class="p">,</span> \
    <span class="n">BooleanProperty</span><span class="p">,</span> <span class="n">OptionProperty</span><span class="p">,</span> <span class="n">AliasProperty</span>
<span class="kn">from</span> <span class="nn">kivy.lang</span> <span class="kn">import</span> <span class="n">Builder</span>
<span class="kn">from</span> <span class="nn">kivy.utils</span> <span class="kn">import</span> <span class="n">get_hex_from_color</span><span class="p">,</span> <span class="n">get_color_from_hex</span>
<span class="kn">from</span> <span class="nn">kivy.uix.widget</span> <span class="kn">import</span> <span class="n">Widget</span>
<span class="kn">from</span> <span class="nn">kivy.uix.scrollview</span> <span class="kn">import</span> <span class="n">ScrollView</span>
<span class="kn">from</span> <span class="nn">kivy.uix.gridlayout</span> <span class="kn">import</span> <span class="n">GridLayout</span>
<span class="kn">from</span> <span class="nn">kivy.uix.label</span> <span class="kn">import</span> <span class="n">Label</span>
<span class="kn">from</span> <span class="nn">kivy.uix.image</span> <span class="kn">import</span> <span class="n">AsyncImage</span><span class="p">,</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">kivy.uix.videoplayer</span> <span class="kn">import</span> <span class="n">VideoPlayer</span>
<span class="kn">from</span> <span class="nn">kivy.uix.anchorlayout</span> <span class="kn">import</span> <span class="n">AnchorLayout</span>
<span class="kn">from</span> <span class="nn">kivy.animation</span> <span class="kn">import</span> <span class="n">Animation</span>
<span class="kn">from</span> <span class="nn">kivy.logger</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">docutils.parsers</span> <span class="kn">import</span> <span class="n">rst</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">roles</span>
<span class="kn">from</span> <span class="nn">docutils</span> <span class="kn">import</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">frontend</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">Directive</span><span class="p">,</span> <span class="n">directives</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst.roles</span> <span class="kn">import</span> <span class="n">set_classes</span>
<span class="kn">from</span> <span class="nn">kivy.parser</span> <span class="kn">import</span> <span class="n">parse_color</span>


<span class="c">#</span>
<span class="c"># Handle some additional roles</span>
<span class="c">#</span>
<span class="k">if</span> <span class="s">&#39;KIVY_DOC&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>

    <span class="k">class</span> <span class="nc">role_doc</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Inline</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">TextElement</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">class</span> <span class="nc">role_video</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">General</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">TextElement</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">class</span> <span class="nc">VideoDirective</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>
        <span class="n">has_content</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">option_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;width&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">nonnegative_int</span><span class="p">,</span>
                       <span class="s">&#39;height&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">nonnegative_int</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">set_classes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">role_video</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span>

    <span class="n">generic_docroles</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;doc&#39;</span><span class="p">:</span> <span class="n">role_doc</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">rolename</span><span class="p">,</span> <span class="n">nodeclass</span> <span class="ow">in</span> <span class="n">generic_docroles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">generic</span> <span class="o">=</span> <span class="n">roles</span><span class="o">.</span><span class="n">GenericRole</span><span class="p">(</span><span class="n">rolename</span><span class="p">,</span> <span class="n">nodeclass</span><span class="p">)</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">roles</span><span class="o">.</span><span class="n">CustomRole</span><span class="p">(</span><span class="n">rolename</span><span class="p">,</span> <span class="n">generic</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;classes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rolename</span><span class="p">]})</span>
        <span class="n">roles</span><span class="o">.</span><span class="n">register_local_role</span><span class="p">(</span><span class="n">rolename</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>

    <span class="n">directives</span><span class="o">.</span><span class="n">register_directive</span><span class="p">(</span><span class="s">&#39;video&#39;</span><span class="p">,</span> <span class="n">VideoDirective</span><span class="p">)</span>

<span class="n">Builder</span><span class="o">.</span><span class="n">load_string</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">#:import parse_color kivy.parser.parse_color</span>



<span class="s">&lt;RstDocument&gt;:</span>
<span class="s">    content: content</span>
<span class="s">    scatter: scatter</span>
<span class="s">    do_scroll_x: False</span>
<span class="s">    canvas.before:</span>
<span class="s">        Color:</span>
<span class="s">            rgba: parse_color(root.colors[&#39;background&#39;])</span>
<span class="s">        Rectangle:</span>
<span class="s">            pos: self.pos</span>
<span class="s">            size: self.size</span>

<span class="s">    Scatter:</span>
<span class="s">        id: scatter</span>
<span class="s">        size_hint_y: None</span>
<span class="s">        height: content.minimum_height</span>
<span class="s">        width: root.width</span>
<span class="s">        scale: 1</span>
<span class="s">        do_translation: False, False</span>
<span class="s">        do_scale: False</span>
<span class="s">        do_rotation: False</span>

<span class="s">        GridLayout:</span>
<span class="s">            id: content</span>
<span class="s">            cols: 1</span>
<span class="s">            height: self.minimum_height</span>
<span class="s">            width: root.width</span>
<span class="s">            padding: 10</span>

<span class="s">&lt;RstTitle&gt;:</span>
<span class="s">    markup: True</span>
<span class="s">    valign: &#39;top&#39;</span>
<span class="s">    font_size:</span>
<span class="s">        sp(self.document.base_font_size - self.section * (</span>
<span class="s">        self.document.base_font_size / 31.0 * 2))</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.texture_size[1] + dp(20)</span>
<span class="s">    text_size: self.width, None</span>
<span class="s">    bold: True</span>

<span class="s">    canvas:</span>
<span class="s">        Color:</span>
<span class="s">            rgba: parse_color(self.document.underline_color)</span>
<span class="s">        Rectangle:</span>
<span class="s">            pos: self.x, self.y + 5</span>
<span class="s">            size: self.width, 1</span>


<span class="s">&lt;RstParagraph&gt;:</span>
<span class="s">    markup: True</span>
<span class="s">    valign: &#39;top&#39;</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.texture_size[1] + self.my</span>
<span class="s">    text_size: self.width - self.mx, None</span>
<span class="s">    font_size: sp(self.document.base_font_size / 2.0)</span>

<span class="s">&lt;RstTerm&gt;:</span>
<span class="s">    size_hint: None, None</span>
<span class="s">    height: label.height</span>
<span class="s">    anchor_x: &#39;left&#39;</span>
<span class="s">    Label:</span>
<span class="s">        id: label</span>
<span class="s">        text: root.text</span>
<span class="s">        markup: True</span>
<span class="s">        valign: &#39;top&#39;</span>
<span class="s">        size_hint: None, None</span>
<span class="s">        size: self.texture_size[0] + dp(10), self.texture_size[1] + dp(10)</span>
<span class="s">        font_size: sp(root.document.base_font_size / 2.0)</span>

<span class="s">&lt;RstBlockQuote&gt;:</span>
<span class="s">    cols: 2</span>
<span class="s">    content: content</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: content.height</span>
<span class="s">    Widget:</span>
<span class="s">        size_hint_x: None</span>
<span class="s">        width: 20</span>
<span class="s">    GridLayout:</span>
<span class="s">        id: content</span>
<span class="s">        cols: 1</span>
<span class="s">        size_hint_y: None</span>
<span class="s">        height: self.minimum_height</span>

<span class="s">&lt;RstLiteralBlock&gt;:</span>
<span class="s">    cols: 1</span>
<span class="s">    content: content</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: content.texture_size[1] + dp(20)</span>
<span class="s">    canvas:</span>
<span class="s">        Color:</span>
<span class="s">            rgb: parse_color(&#39;#cccccc&#39;)</span>
<span class="s">        Rectangle:</span>
<span class="s">            pos: self.x - 1, self.y - 1</span>
<span class="s">            size: self.width + 2, self.height + 2</span>
<span class="s">        Color:</span>
<span class="s">            rgb: parse_color(&#39;#eeeeee&#39;)</span>
<span class="s">        Rectangle:</span>
<span class="s">            pos: self.pos</span>
<span class="s">            size: self.size</span>
<span class="s">    Label:</span>
<span class="s">        id: content</span>
<span class="s">        markup: True</span>
<span class="s">        valign: &#39;top&#39;</span>
<span class="s">        text_size: self.width - 20, None</span>
<span class="s">        font_name: &#39;data/fonts/DroidSansMono.ttf&#39;</span>
<span class="s">        color: (0, 0, 0, 1)</span>

<span class="s">&lt;RstList&gt;:</span>
<span class="s">    cols: 2</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>

<span class="s">&lt;RstListItem&gt;:</span>
<span class="s">    cols: 1</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>

<span class="s">&lt;RstSystemMessage&gt;:</span>
<span class="s">    cols: 1</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>
<span class="s">    canvas:</span>
<span class="s">        Color:</span>
<span class="s">            rgba: 1, 0, 0, .3</span>
<span class="s">        Rectangle:</span>
<span class="s">            pos: self.pos</span>
<span class="s">            size: self.size</span>

<span class="s">&lt;RstWarning&gt;:</span>
<span class="s">    content: content</span>
<span class="s">    cols: 1</span>
<span class="s">    padding: 20</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>
<span class="s">    canvas:</span>
<span class="s">        Color:</span>
<span class="s">            rgba: 1, 0, 0, .5</span>
<span class="s">        Rectangle:</span>
<span class="s">            pos: self.x + 10, self.y + 10</span>
<span class="s">            size: self.width - 20, self.height - 20</span>
<span class="s">    GridLayout:</span>
<span class="s">        cols: 1</span>
<span class="s">        id: content</span>
<span class="s">        size_hint_y: None</span>
<span class="s">        height: self.minimum_height</span>

<span class="s">&lt;RstNote&gt;:</span>
<span class="s">    content: content</span>
<span class="s">    cols: 1</span>
<span class="s">    padding: 20</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>
<span class="s">    canvas:</span>
<span class="s">        Color:</span>
<span class="s">            rgba: 0, 1, 0, .5</span>
<span class="s">        Rectangle:</span>
<span class="s">            pos: self.x + 10, self.y + 10</span>
<span class="s">            size: self.width - 20, self.height - 20</span>
<span class="s">    GridLayout:</span>
<span class="s">        cols: 1</span>
<span class="s">        id: content</span>
<span class="s">        size_hint_y: None</span>
<span class="s">        height: self.minimum_height</span>

<span class="s">&lt;RstImage&gt;:</span>
<span class="s">    size_hint: None, None</span>
<span class="s">    size: self.texture_size[0], self.texture_size[1] + dp(10)</span>

<span class="s">&lt;RstAsyncImage&gt;:</span>
<span class="s">    size_hint: None, None</span>
<span class="s">    size: self.texture_size[0], self.texture_size[1] + dp(10)</span>

<span class="s">&lt;RstDefinitionList&gt;:</span>
<span class="s">    cols: 1</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>
<span class="s">    font_size: sp(self.document.base_font_size / 2.0)</span>

<span class="s">&lt;RstDefinition&gt;:</span>
<span class="s">    cols: 2</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>
<span class="s">    font_size: sp(self.document.base_font_size / 2.0)</span>

<span class="s">&lt;RstFieldList&gt;:</span>
<span class="s">    cols: 2</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>

<span class="s">&lt;RstFieldName&gt;:</span>
<span class="s">    markup: True</span>
<span class="s">    valign: &#39;top&#39;</span>
<span class="s">    size_hint: 0.2, 1</span>
<span class="s">    color: (0, 0, 0, 1)</span>
<span class="s">    bold: True</span>
<span class="s">    text_size: self.width-10, self.height - 10</span>
<span class="s">    valign: &#39;top&#39;</span>
<span class="s">    font_size: sp(self.document.base_font_size / 2.0)</span>

<span class="s">&lt;RstFieldBody&gt;:</span>
<span class="s">    cols: 1</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>

<span class="s">&lt;RstTable&gt;:</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>

<span class="s">&lt;RstEntry&gt;:</span>
<span class="s">    cols: 1</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: self.minimum_height</span>

<span class="s">    canvas:</span>
<span class="s">        Color:</span>
<span class="s">            rgb: .2, .2, .2</span>
<span class="s">        Line:</span>
<span class="s">            points: [</span><span class="se">\</span>
<span class="s">            self.x,</span><span class="se">\</span>
<span class="s">            self.y,</span><span class="se">\</span>
<span class="s">            self.right,</span><span class="se">\</span>
<span class="s">            self.y,</span><span class="se">\</span>
<span class="s">            self.right,</span><span class="se">\</span>
<span class="s">            self.top,</span><span class="se">\</span>
<span class="s">            self.x,</span><span class="se">\</span>
<span class="s">            self.top,</span><span class="se">\</span>
<span class="s">            self.x,</span><span class="se">\</span>
<span class="s">            self.y]</span>

<span class="s">&lt;RstTransition&gt;:</span>
<span class="s">    size_hint_y: None</span>
<span class="s">    height: 20</span>
<span class="s">    canvas:</span>
<span class="s">        Color:</span>
<span class="s">            rgb: .2, .2, .2</span>
<span class="s">        Line:</span>
<span class="s">            points: [self.x, self.center_y, self.right, self.center_y]</span>

<span class="s">&lt;RstListBullet&gt;:</span>
<span class="s">    markup: True</span>
<span class="s">    valign: &#39;top&#39;</span>
<span class="s">    size_hint_x: None</span>
<span class="s">    width: self.texture_size[0] + dp(10)</span>
<span class="s">    text_size: None, self.height - dp(10)</span>
<span class="s">    font_size: sp(self.document.base_font_size / 2.0)</span>

<span class="s">&lt;RstEmptySpace&gt;:</span>
<span class="s">    size_hint: 0.01, 0.01</span>

<span class="s">&lt;RstDefinitionSpace&gt;:</span>
<span class="s">    size_hint: None, 0.1</span>
<span class="s">    width: 50</span>
<span class="s">    font_size: sp(self.document.base_font_size / 2.0)</span>

<span class="s">&lt;RstVideoPlayer&gt;:</span>
<span class="s">    options: {&#39;allow_stretch&#39;: True}</span>
<span class="s">    canvas.before:</span>
<span class="s">        Color:</span>
<span class="s">            rgba: (1, 1, 1, 1)</span>
<span class="s">        BorderImage:</span>
<span class="s">            source: &#39;atlas://data/images/defaulttheme/player-background&#39;</span>
<span class="s">            pos: self.x - 25, self.y - 25</span>
<span class="s">            size: self.width + 50, self.height + 50</span>
<span class="s">            border: (25, 25, 25, 25)</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstVideoPlayer</span><span class="p">(</span><span class="n">VideoPlayer</span><span class="p">):</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="RstDocument"><a class="viewcode-back" href="../../../api-kivy.uix.rst.html#kivy.uix.rst.RstDocument">[docs]</a><span class="k">class</span> <span class="nc">RstDocument</span><span class="p">(</span><span class="n">ScrollView</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Base widget used to store an Rst document. See module documentation for</span>
<span class="sd">    more information.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Filename of the RST document.</span>

<span class="sd">    :attr:`source` is a :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to None.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">source_encoding</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Encoding to be used for the :attr:`source` file.</span>

<span class="sd">    :attr:`source_encoding` is a :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to `utf-8`.</span>

<span class="sd">    .. Note::</span>
<span class="sd">        It is your responsibility to ensure that the value provided is a</span>
<span class="sd">        valid codec supported by python.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">source_error</span> <span class="o">=</span> <span class="n">OptionProperty</span><span class="p">(</span><span class="s">&#39;strict&#39;</span><span class="p">,</span>
                                  <span class="n">options</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;strict&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span>
                                           <span class="s">&#39;xmlcharrefreplace&#39;</span><span class="p">,</span>
                                           <span class="s">&#39;backslashreplac&#39;</span><span class="p">))</span>
    <span class="sd">&#39;&#39;&#39;Error handling to be used while encoding the :attr:`source` file.</span>

<span class="sd">    :attr:`source_error` is an :class:`~kivy.properties.OptionProperty` and</span>
<span class="sd">    defaults to `strict`. Can be one of &#39;strict&#39;, &#39;ignore&#39;, &#39;replace&#39;,</span>
<span class="sd">    &#39;xmlcharrefreplace&#39; or &#39;backslashreplac&#39;.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;RST markup text of the document.</span>

<span class="sd">    :attr:`text` is a :class:`~kivy.properties.StringProperty` and defaults to</span>
<span class="sd">    None.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">document_root</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Root path where :doc: will search for rst documents. If no path is</span>
<span class="sd">    given, it will use the directory of the first loaded source file.</span>

<span class="sd">    :attr:`document_root` is a :class:`~kivy.properties.StringProperty` and</span>
<span class="sd">    defaults to None.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">base_font_size</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Font size for the biggest title, 31 by default. All other font sizes are</span>
<span class="sd">    derived from this.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">show_errors</span> <span class="o">=</span> <span class="n">BooleanProperty</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Indicate whether RST parsers errors should be shown on the screen</span>
<span class="sd">    or not.</span>

<span class="sd">    :attr:`show_errors` is a :class:`~kivy.properties.BooleanProperty` and</span>
<span class="sd">    defaults to False.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">_get_bgc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_color_from_hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_bgc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">get_hex_from_color</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">background_color</span> <span class="o">=</span> <span class="n">AliasProperty</span><span class="p">(</span><span class="n">_get_bgc</span><span class="p">,</span> <span class="n">_set_bgc</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;colors&#39;</span><span class="p">,))</span>
    <span class="sd">&#39;&#39;&#39;Specifies the background_color to be used for the RstDocument.</span>

<span class="sd">    .. versionadded:: 1.8.0</span>

<span class="sd">    :attr:`background_color` is an :class:`~kivy.properties.AliasProperty`</span>
<span class="sd">    for colors[&#39;background&#39;].</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">({</span>
        <span class="s">&#39;background&#39;</span><span class="p">:</span> <span class="s">&#39;e5e6e9ff&#39;</span><span class="p">,</span>
        <span class="s">&#39;link&#39;</span><span class="p">:</span> <span class="s">&#39;ce5c00ff&#39;</span><span class="p">,</span>
        <span class="s">&#39;paragraph&#39;</span><span class="p">:</span> <span class="s">&#39;202020ff&#39;</span><span class="p">,</span>
        <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;204a87ff&#39;</span><span class="p">,</span>
        <span class="s">&#39;bullet&#39;</span><span class="p">:</span> <span class="s">&#39;000000ff&#39;</span><span class="p">})</span>
    <span class="sd">&#39;&#39;&#39;Dictionary of all the colors used in the RST rendering.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        This dictionary is needs special handling. You also need to call</span>
<span class="sd">        :meth:`RstDocument.render` if you change them after loading.</span>

<span class="sd">    :attr:`colors` is a :class:`~kivy.properties.DictProperty`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;Title of the current document.</span>

<span class="sd">    :attr:`title` is a :class:`~kivy.properties.StringProperty` and defaults to</span>
<span class="sd">    &#39;&#39;. It is read-only.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">toctrees</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">({})</span>
    <span class="sd">&#39;&#39;&#39;Toctree of all loaded or preloaded documents. This dictionary is filled</span>
<span class="sd">    when a rst document is explicitly loaded or where :meth:`preload` has been</span>
<span class="sd">    called.</span>

<span class="sd">    If the document has no filename, e.g. when the document is loaded from a</span>
<span class="sd">    text file, the key will be &#39;&#39;.</span>

<span class="sd">    :attr:`toctrees` is a :class:`~kivy.properties.DictProperty` and defaults</span>
<span class="sd">    to {}.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">underline_color</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s">&#39;204a9699&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;underline color of the titles, expressed in html color notation</span>

<span class="sd">    :attr:`underline_color` is a</span>
<span class="sd">    :class:`~kivy.properties.StringProperty` and defaults to &#39;204a9699&#39;.</span>

<span class="sd">    .. versionadded: 1.9.0</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c"># internals.</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">anchors_widgets</span> <span class="o">=</span> <span class="n">ListProperty</span><span class="p">([])</span>
    <span class="n">refs_assoc</span> <span class="o">=</span> <span class="n">DictProperty</span><span class="p">({})</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_load</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">create_trigger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_from_text</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="o">=</span> <span class="n">rst</span><span class="o">.</span><span class="n">Parser</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span> <span class="o">=</span> <span class="n">frontend</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span>
            <span class="n">components</span><span class="o">=</span><span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">Parser</span><span class="p">,</span> <span class="p">))</span><span class="o">.</span><span class="n">get_default_values</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RstDocument</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_root</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># set the documentation root to the directory name of the</span>
            <span class="c"># first tile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">document_root</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_source</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trigger_load</span><span class="p">()</span>

<div class="viewcode-block" id="RstDocument.render"><a class="viewcode-back" href="../../../api-kivy.uix.rst.html#kivy.uix.rst.RstDocument.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Force document rendering.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_text</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="RstDocument.resolve_path"><a class="viewcode-back" href="../../../api-kivy.uix.rst.html#kivy.uix.rst.RstDocument.resolve_path">[docs]</a>    <span class="k">def</span> <span class="nf">resolve_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the path for this filename. If the filename doesn&#39;t exist,</span>
<span class="sd">        it returns the document_root + filename.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">filename</span>
        <span class="k">return</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document_root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RstDocument.preload"><a class="viewcode-back" href="../../../api-kivy.uix.rst.html#kivy.uix.rst.RstDocument.preload">[docs]</a>    <span class="k">def</span> <span class="nf">preload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;strict&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Preload a rst file to get its toctree and its title.</span>

<span class="sd">        The result will be stored in :attr:`toctrees` with the ``filename`` as</span>
<span class="sd">        key.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
        <span class="c"># parse the source</span>
        <span class="n">document</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">new_document</span><span class="p">(</span><span class="s">&#39;Document&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">document</span><span class="p">)</span>
        <span class="c"># fill the current document node</span>
        <span class="n">visitor</span> <span class="o">=</span> <span class="n">_ToctreeVisitor</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
        <span class="n">document</span><span class="o">.</span><span class="n">walkabout</span><span class="p">(</span><span class="n">visitor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toctrees</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">.</span><span class="n">toctree</span>
        <span class="k">return</span> <span class="n">text</span>
</div>
    <span class="k">def</span> <span class="nf">_load_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preload</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">source_encoding</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">source_error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_from_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># clear the current widgets</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">clear_widgets</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anchors_widgets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refs_assoc</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c"># parse the source</span>
            <span class="n">document</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">new_document</span><span class="p">(</span><span class="s">&#39;Document&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="n">PY2</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">document</span><span class="p">)</span>

            <span class="c"># fill the current document node</span>
            <span class="n">visitor</span> <span class="o">=</span> <span class="n">_Visitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">)</span>
            <span class="n">document</span><span class="o">.</span><span class="n">walkabout</span><span class="p">(</span><span class="n">visitor</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">visitor</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="s">&#39;No title&#39;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">Logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&#39;Rst: error while loading text&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_ref_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

<div class="viewcode-block" id="RstDocument.goto"><a class="viewcode-back" href="../../../api-kivy.uix.rst.html#kivy.uix.rst.RstDocument.goto">[docs]</a>    <span class="k">def</span> <span class="nf">goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Scroll to the reference. If it&#39;s not found, nothing will be done.</span>

<span class="sd">        For this text::</span>

<span class="sd">            .. _myref:</span>

<span class="sd">            This is something I always wanted.</span>

<span class="sd">        You can do::</span>

<span class="sd">            from kivy.clock import Clock</span>
<span class="sd">            from functools import partial</span>

<span class="sd">            doc = RstDocument(...)</span>
<span class="sd">            Clock.schedule_once(partial(doc.goto, &#39;myref&#39;), 0.1)</span>

<span class="sd">        .. note::</span>

<span class="sd">            It is preferable to delay the call of the goto if you just loaded</span>
<span class="sd">            the document because the layout might not be finished or the</span>
<span class="sd">            size of the RstDocument has not yet been determined. In</span>
<span class="sd">            either case, the calculation of the scrolling would be</span>
<span class="sd">            wrong.</span>

<span class="sd">            You can, however, do a direct call if the document is already</span>
<span class="sd">            loaded.</span>

<span class="sd">        .. versionadded:: 1.3.0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># check if it&#39;s a file ?</span>
        <span class="k">if</span> <span class="n">ref</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.rst&#39;</span><span class="p">):</span>
            <span class="c"># whether it&#39;s a valid or invalid file, let source deal with it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">ref</span>
            <span class="k">return</span>

        <span class="c"># get the association</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs_assoc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="c"># search into all the nodes containing anchors</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ay</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchors_widgets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">anchors</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">,</span> <span class="n">ay</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">anchors</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span>
                <span class="k">break</span>

        <span class="c"># not found, stop here</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># found, calculate the real coordinate</span>

        <span class="c"># get the anchor coordinate inside widget space</span>
        <span class="n">ax</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span>
        <span class="n">ay</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">top</span> <span class="o">-</span> <span class="n">ay</span>
        <span class="c">#ay += node.y</span>

        <span class="c"># what&#39;s the current coordinate for us?</span>
        <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scatter</span><span class="o">.</span><span class="n">top</span>
        <span class="c">#ax, ay = self.scatter.to_parent(ax, ay)</span>

        <span class="n">ay</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>

        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_distance_to_scroll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ay</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dy</span><span class="p">))</span>
        <span class="n">Animation</span><span class="p">(</span><span class="n">scroll_y</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span> <span class="n">d</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="s">&#39;in_out_expo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">add_anchors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchors_widgets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">RstTitle</span><span class="p">(</span><span class="n">Label</span><span class="p">):</span>

    <span class="n">section</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstParagraph</span><span class="p">(</span><span class="n">Label</span><span class="p">):</span>

    <span class="n">mx</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">my</span> <span class="o">=</span> <span class="n">NumericProperty</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstTerm</span><span class="p">(</span><span class="n">AnchorLayout</span><span class="p">):</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">StringProperty</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstBlockQuote</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstLiteralBlock</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstList</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstListItem</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstListBullet</span><span class="p">(</span><span class="n">Label</span><span class="p">):</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstSystemMessage</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstWarning</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstNote</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstImage</span><span class="p">(</span><span class="n">Image</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstAsyncImage</span><span class="p">(</span><span class="n">AsyncImage</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstDefinitionList</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstDefinition</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstFieldList</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstFieldName</span><span class="p">(</span><span class="n">Label</span><span class="p">):</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RstFieldBody</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstGridLayout</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstTable</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstEntry</span><span class="p">(</span><span class="n">GridLayout</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstTransition</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstEmptySpace</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RstDefinitionSpace</span><span class="p">(</span><span class="n">Widget</span><span class="p">):</span>

    <span class="n">document</span> <span class="o">=</span> <span class="n">ObjectProperty</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_ToctreeVisitor</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">NodeVisitor</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toctree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">NodeVisitor</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">tree</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dispatch_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">__class__</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">section</span><span class="p">:</span>
            <span class="n">section</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;ids&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;ids&#39;</span><span class="p">],</span>
                <span class="s">&#39;names&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;names&#39;</span><span class="p">],</span>
                <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                <span class="s">&#39;children&#39;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s">&#39;children&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">dispatch_departure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">__class__</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">section</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>


<span class="k">class</span> <span class="nc">_Visitor</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">NodeVisitor</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_have_anchor</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_strip_text</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">NodeVisitor</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">largs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">widget</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dispatch_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">__class__</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">document</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">section</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">RstTitle</span><span class="p">(</span><span class="n">section</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">section</span><span class="p">,</span> <span class="n">document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="c">#assert(self.text == &#39;&#39;)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_strip_text</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;  &#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;  &#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">node</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">paragraph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_strip_text</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">RstParagraph</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">RstEntry</span><span class="p">):</span>
                <span class="n">label</span><span class="o">.</span><span class="n">mx</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">literal_block</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">RstLiteralBlock</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">emphasis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[i]&#39;</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">strong</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[b]&#39;</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">literal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[font=fonts/DroidSansMono.ttf]&#39;</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">block_quote</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">RstBlockQuote</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">enumerated_list</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">RstList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idx_list</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">bullet_list</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">RstList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idx_list</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">list_item</span><span class="p">:</span>
            <span class="n">bullet</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">idx_list</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">bullet</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_list</span>
            <span class="n">bullet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">bullet</span><span class="p">,</span> <span class="s">&#39;bullet&#39;</span><span class="p">)</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">RstListItem</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">RstListBullet</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="n">bullet</span><span class="p">,</span> <span class="n">document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">system_message</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">RstSystemMessage</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">show_errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">warning</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">RstWarning</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">note</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">RstNote</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">image</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;uri&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">document_root</span><span class="p">:</span>
                <span class="n">uri</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">document_root</span><span class="p">,</span> <span class="n">uri</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;http://&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;https://&#39;</span><span class="p">):</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">RstAsyncImage</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">uri</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">RstImage</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">uri</span><span class="p">)</span>

            <span class="n">align</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;align&#39;</span><span class="p">,</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">AnchorLayout</span><span class="p">(</span><span class="n">size_hint_y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">anchor_x</span><span class="o">=</span><span class="n">align</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">image</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">root</span><span class="o">.</span><span class="n">setter</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">))</span>
            <span class="n">root</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">definition_list</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="n">RstDefinitionList</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">term</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">RstDefinitionList</span><span class="p">))</span>
            <span class="n">term</span> <span class="o">=</span> <span class="n">RstTerm</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">definition</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">RstDefinitionList</span><span class="p">))</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="n">RstDefinition</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="n">definition</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">RstDefinitionSpace</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">definition</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">field_list</span><span class="p">:</span>
            <span class="n">fieldlist</span> <span class="o">=</span> <span class="n">RstFieldList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">fieldlist</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">fieldlist</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">field_name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">RstFieldName</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">field_body</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">RstFieldBody</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">table</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">RstTable</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">colspec</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">cols</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">entry</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">RstEntry</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">transition</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">RstTransition</span><span class="p">())</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">reference</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;refuri&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[ref=</span><span class="si">%s</span><span class="s">][color=</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s">&#39;link&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;paragraph&#39;</span><span class="p">)))</span>
            <span class="k">if</span> <span class="s">&#39;refname&#39;</span> <span class="ow">in</span> <span class="n">node</span> <span class="ow">and</span> <span class="s">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">refs_assoc</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;refname&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="s">&#39;ids&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s">&#39;names&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;names&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[anchor=</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_have_anchor</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">role_doc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doc_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">role_video</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">dispatch_departure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">__class__</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">document</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">section</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">section</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">RstTitle</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">paragraph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_strip_text</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">RstParagraph</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="s">&#39;paragraph&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">literal_block</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">RstLiteralBlock</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s">&#39;literal_block&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">emphasis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[/i]&#39;</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">strong</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[/b]&#39;</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">literal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[/font]&#39;</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">block_quote</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">enumerated_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idx_list</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">bullet_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">list_item</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">system_message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">warning</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">note</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">definition_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">term</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">RstTerm</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="s">&#39;term&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">definition</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">field_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">field_name</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">RstFieldName</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="s">&#39;field_name&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">field_body</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">table</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">colspec</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">entry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">nodes</span><span class="o">.</span><span class="n">reference</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;[/color][/ref]&#39;</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">role_doc</span><span class="p">:</span>
            <span class="n">docname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_index</span><span class="p">:]</span>
            <span class="n">rst_docname</span> <span class="o">=</span> <span class="n">docname</span>
            <span class="k">if</span> <span class="n">rst_docname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.rst&#39;</span><span class="p">):</span>
                <span class="n">docname</span> <span class="o">=</span> <span class="n">docname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rst_docname</span> <span class="o">+=</span> <span class="s">&#39;.rst&#39;</span>

            <span class="c"># try to preload it</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">resolve_path</span><span class="p">(</span><span class="n">rst_docname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">preload</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="c"># if exist, use the title of the first section found in the</span>
            <span class="c"># document</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">docname</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">toctrees</span><span class="p">:</span>
                <span class="n">toctree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">toctrees</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toctree</span><span class="p">):</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">toctree</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;title&#39;</span><span class="p">]</span>

            <span class="c"># replace the text with a good reference</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;[ref=</span><span class="si">%s</span><span class="s">]</span><span class="si">%s</span><span class="s">[/ref]&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">rst_docname</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;link&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">text</span>

        <span class="k">elif</span> <span class="n">cls</span> <span class="ow">is</span> <span class="n">role_video</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;width&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attlist</span><span class="p">()</span> <span class="k">else</span> <span class="mi">400</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;height&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attlist</span><span class="p">()</span> <span class="k">else</span> <span class="mi">300</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">document_root</span><span class="p">:</span>
                <span class="n">uri</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">document_root</span><span class="p">,</span> <span class="n">uri</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">video</span> <span class="o">=</span> <span class="n">RstVideoPlayer</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
                <span class="n">size_hint</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="n">AnchorLayout</span><span class="p">(</span><span class="n">size_hint_y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">anchor</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">video</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">anchor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="o">==</span> <span class="s">&#39;term&#39;</span> <span class="ow">or</span> <span class="n">parent</span> <span class="o">==</span> <span class="s">&#39;field_name&#39;</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;[b]</span><span class="si">%s</span><span class="s">[/b]&#39;</span> <span class="o">%</span> <span class="n">text</span>
        <span class="c"># search anchors</span>
        <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">on_ref_press</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">on_ref_press</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_have_anchor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">add_anchors</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_have_anchor</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">colorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;[color=</span><span class="si">%s</span><span class="s">]</span><span class="si">%s</span><span class="s">[/color]&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="s">&#39;paragraph&#39;</span><span class="p">]),</span>
            <span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">kivy.base</span> <span class="kn">import</span> <span class="n">runTouchApp</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">runTouchApp</span><span class="p">(</span><span class="n">RstDocument</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>

            <div class="footerlinks">
              </div>
          </div>
        </div>
      </div>
      </div>
      <div class="clearer"></div>
    </div>
    </div>
<!-- Piwik --> 
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://txzone.net/piwik/" : "http://txzone.net/piwik/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 8);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://txzone.net/piwik/piwik.php?idsite=8" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->
    <!--
    <div class="footer">
      &copy; Copyright 2010, The Kivy Authors.
      Last updated on Dec 11, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b1.
</div>
-->
  </body>

<!-- Mirrored from kivy.org/docs/_modules/kivy/uix/rst.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 13 Jan 2015 07:56:38 GMT -->
</html>